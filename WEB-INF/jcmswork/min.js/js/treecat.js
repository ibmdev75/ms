"Ajax.Tree"._namespace({_downloadChildrenHooks:$H(),registerDownloadChildrenHook:function(c,a){var b=Ajax.Tree._downloadChildrenHooks.get(c);if(!b){b=$A();Ajax.Tree._downloadChildrenHooks.set(c,b)}b.push(a)},invokeDownloadChildrenHook:function(c,a){var b=Ajax.Tree._downloadChildrenHooks.get(c);if(!b){return}b.each(function(d){d(a)})},downloadChildren:function(d,e,f,c,h,a){JcmsLogger.debug("TreeCat","downloadChildren():",e,d,c,h);var g=new JcmsJsonRequest(d);var i=function(){if(d){Ajax.Tree._getRpcTree(e).getChildren(g.asyncJsonCallBack.bind(g),$(d).getJcmsId())}else{var l=Ajax.Tree._getRpcTree(e);var k=g.asyncJsonCallBack.bind(g);if(l){l.getChildren(k,c,h)}else{k(" ")}}};var b=function(k){if(!k){f.parentNode.removeChild(f);return}f.innerHTML=k;if(a){a()}Ajax.Tree.invokeDownloadChildrenHook(e,f)};var j=function(){f.parentNode.removeChild(f);Ajax.Tree.toggleOpenClose(d)};g.rpc=i;g.callback=b;g.exception=j;g.asyncJsonCall()},rename:function(e,c,d){JcmsLogger.debug("TreeCat","rename():",e,c,d);var a=new JcmsJsonRequest();var b=function(){Ajax.Tree._getRpcTree(e).rename(function(f){Ajax.Tree._handleRPCResponse(a,f,e)},c,d)};a.rpc=b;a.callback=Ajax.Tree._callbackRefresh;a.asyncJsonCall()},addSubCat:function(e,c,d){JcmsLogger.debug("TreeCat","addSubCat():",e,c,d);var a=new JcmsJsonRequest();var b=function(){Ajax.Tree._getRpcTree(e).addSubCat(function(f){Ajax.Tree._handleRPCResponse(a,f,e)},c,d)};a.rpc=b;a.callback=function(g,f){Ajax.Tree._callbackRefresh(g,f,c)};a.asyncJsonCall()},addSiblingCat:function(e,c,d){JcmsLogger.debug("TreeCat","addSiblingCat():",e,c,d);var a=new JcmsJsonRequest();var b=function(){Ajax.Tree._getRpcTree(e).addSiblingCat(function(f){Ajax.Tree._handleRPCResponse(a,f,e)},c,d)};a.rpc=b;a.callback=function(g,f){Ajax.Tree._callbackRefresh(g,f)};a.asyncJsonCall()},remove:function(d,c){JcmsLogger.debug("TreeCat","remove():",d,c);var a=new JcmsJsonRequest();var b=function(){Ajax.Tree._getRpcTree(d).remove(function(e){Ajax.Tree._handleRPCResponse(a,e,d)},c)};a.rpc=b;a.callback=Ajax.Tree._callbackRefresh;a.asyncJsonCall()},setParent:function(d,c,e){JcmsLogger.debug("TreeCat","setParent():",d,c,e);var a=new JcmsJsonRequest();var b=function(){Ajax.Tree._getRpcTree(d).setParent(function(f){Ajax.Tree._handleRPCResponse(a,f,d)},c,e)};a.rpc=b;a.callback=function(g,f){Ajax.Tree._callbackRefresh(g,f,e)};a.asyncJsonCall()},refresh:function(g,d,e){JcmsLogger.debug("TreeCat","refresh():",g,d);Ajax.setWaitState(true);var c=$(g);if(d){d=Object.isArray(d)?$A(d):$A([d])}var b=new Array();var f=new Array();$A(c.getElementsByTagName("INPUT")).each(function(i,h){if(i.checked){f.push(i.value);return}if(d&&i.disabled&&d.indexOf(i.value)>=0){d=d.without(i.value)}});$A(c.select("LI.open")).each(function(k,h){var j=k.down();if(j){var i=$(j).getJcmsId();b.push(i);JcmsLogger.debug("TreeCat","Opened:",i)}});if(d){b=b.concat(d);if(e&&!c.hasClassName("follow")){f=f.concat(d)}}c.innerHTML="<li><img src='s.gif' class='loading'/> Loading...</li>";var a=null;if(c.hasClassName("follow")&&d&&d.length==1){a=function(){Ajax.Tree._followRefreshCallback(g,d)}}Ajax.Tree.downloadChildren(null,g,c,f,b,a)},_followRefreshCallback:function(f,e){var c=$(f);var d=c.select("IMG.ID_"+e);if(!d||!d[0]){JcmsLogger.warn("TreeCat","Id not found",e);return}var b=d[0];var a=b.next("A");if(c.hasClassName("fire")){JcmsLogger.debug("TreeCat","fire jcms:click",a);a.fire("jcms:click")}else{if(a){document.location=a.href}}},_importChildren:function(b){var a=$(b.parentNode);if(a.hasClassName("imported")){return}Ajax.setWaitState(true,b);var c=document.createElement("UL");c.innerHTML="<li><img src='s.gif' class='loading'/> Loading...</li>";a.appendChild(c);a.addClassName("imported");var d=$(b).fastUp("UL","TreeCat").id;Ajax.Tree.downloadChildren(b,d,c)},toggleOpenClose:function(b){if(!b){return}var a=$(b.parentNode);a.toggleClassName("tree-close");a.toggleClassName("tree-open");Ajax.Tree._importChildren(b)},getAjaxSuffix:function(b){if(!b){return}var b=$(b);if(b.id&&b.id.indexOf("proxy")>=0){return b.id.substring(6)}var a=b.fastUp("UL","TreeCat");if(!a){return}JcmsLogger.debug("TreeCat","getAjaxSuffix():",a.id);return a.id},getCategoryId:function(d,c){if(!d){return}c=(c||0)+1;if(c>42){return}if(d.tagName=="LI"){var a=d.down(0);return Ajax.Tree.getCategoryId(a,c)}else{if(d.tagName=="IMG"||d.tagName=="A"){return $(d).getJcmsId()}else{var b=d.up("UL.TreeCat LI");return Ajax.Tree.getCategoryId(b,c)}}},_getRpcTree:function(a){if(!a){return JcmsJsContext.getJsonRPC().AjaxTree}else{return JcmsJsContext.getJsonRPC()["AjaxTree"+a]}},_callbackRefresh:function(d,a,c){JcmsLogger.debug("TreeCat","Callback Refresh",d,a,c);if(d){if(c){var b=new Array();b.push(c);Ajax.Tree.refresh(d,b)}else{Ajax.Tree.refresh(d)}}},_handleRPCResponse:function(a,c,b){if(c){alert(c);a.asyncJsonCallBack();return}a.asyncJsonCallBack(b)}});