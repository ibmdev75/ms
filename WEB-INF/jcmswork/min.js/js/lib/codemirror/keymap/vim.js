(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../lib/codemirror"),require("../addon/search/searchcursor"),require("../addon/dialog/dialog"))}else{if(typeof define=="function"&&define.amd){define(["../lib/codemirror","../addon/search/searchcursor","../addon/dialog/dialog"],a)}else{a(CodeMirror)}}})(function(b){var a=[{keys:["<Left>"],type:"keyToKey",toKeys:["h"]},{keys:["<Right>"],type:"keyToKey",toKeys:["l"]},{keys:["<Up>"],type:"keyToKey",toKeys:["k"]},{keys:["<Down>"],type:"keyToKey",toKeys:["j"]},{keys:["<Space>"],type:"keyToKey",toKeys:["l"]},{keys:["<BS>"],type:"keyToKey",toKeys:["h"]},{keys:["<C-Space>"],type:"keyToKey",toKeys:["W"]},{keys:["<C-BS>"],type:"keyToKey",toKeys:["B"]},{keys:["<S-Space>"],type:"keyToKey",toKeys:["w"]},{keys:["<S-BS>"],type:"keyToKey",toKeys:["b"]},{keys:["<C-n>"],type:"keyToKey",toKeys:["j"]},{keys:["<C-p>"],type:"keyToKey",toKeys:["k"]},{keys:["<C-[>"],type:"keyToKey",toKeys:["<Esc>"]},{keys:["<C-c>"],type:"keyToKey",toKeys:["<Esc>"]},{keys:["s"],type:"keyToKey",toKeys:["c","l"],context:"normal"},{keys:["s"],type:"keyToKey",toKeys:["x","i"],context:"visual"},{keys:["S"],type:"keyToKey",toKeys:["c","c"],context:"normal"},{keys:["S"],type:"keyToKey",toKeys:["d","c","c"],context:"visual"},{keys:["<Home>"],type:"keyToKey",toKeys:["0"]},{keys:["<End>"],type:"keyToKey",toKeys:["$"]},{keys:["<PageUp>"],type:"keyToKey",toKeys:["<C-b>"]},{keys:["<PageDown>"],type:"keyToKey",toKeys:["<C-f>"]},{keys:["<CR>"],type:"keyToKey",toKeys:["j","^"],context:"normal"},{keys:["H"],type:"motion",motion:"moveToTopLine",motionArgs:{linewise:true,toJumplist:true}},{keys:["M"],type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:true,toJumplist:true}},{keys:["L"],type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:true,toJumplist:true}},{keys:["h"],type:"motion",motion:"moveByCharacters",motionArgs:{forward:false}},{keys:["l"],type:"motion",motion:"moveByCharacters",motionArgs:{forward:true}},{keys:["j"],type:"motion",motion:"moveByLines",motionArgs:{forward:true,linewise:true}},{keys:["k"],type:"motion",motion:"moveByLines",motionArgs:{forward:false,linewise:true}},{keys:["g","j"],type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:true}},{keys:["g","k"],type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:false}},{keys:["w"],type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false}},{keys:["W"],type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false,bigWord:true}},{keys:["e"],type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,inclusive:true}},{keys:["E"],type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,bigWord:true,inclusive:true}},{keys:["b"],type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false}},{keys:["B"],type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false,bigWord:true}},{keys:["g","e"],type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,inclusive:true}},{keys:["g","E"],type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,bigWord:true,inclusive:true}},{keys:["{"],type:"motion",motion:"moveByParagraph",motionArgs:{forward:false,toJumplist:true}},{keys:["}"],type:"motion",motion:"moveByParagraph",motionArgs:{forward:true,toJumplist:true}},{keys:["<C-f>"],type:"motion",motion:"moveByPage",motionArgs:{forward:true}},{keys:["<C-b>"],type:"motion",motion:"moveByPage",motionArgs:{forward:false}},{keys:["<C-d>"],type:"motion",motion:"moveByScroll",motionArgs:{forward:true,explicitRepeat:true}},{keys:["<C-u>"],type:"motion",motion:"moveByScroll",motionArgs:{forward:false,explicitRepeat:true}},{keys:["g","g"],type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:["G"],type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:true,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:["0"],type:"motion",motion:"moveToStartOfLine"},{keys:["^"],type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["+"],type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true}},{keys:["-"],type:"motion",motion:"moveByLines",motionArgs:{forward:false,toFirstChar:true}},{keys:["_"],type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true,repeatOffset:-1}},{keys:["$"],type:"motion",motion:"moveToEol",motionArgs:{inclusive:true}},{keys:["%"],type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:true,toJumplist:true}},{keys:["f","character"],type:"motion",motion:"moveToCharacter",motionArgs:{forward:true,inclusive:true}},{keys:["F","character"],type:"motion",motion:"moveToCharacter",motionArgs:{forward:false}},{keys:["t","character"],type:"motion",motion:"moveTillCharacter",motionArgs:{forward:true,inclusive:true}},{keys:["T","character"],type:"motion",motion:"moveTillCharacter",motionArgs:{forward:false}},{keys:[";"],type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:true}},{keys:[","],type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:false}},{keys:["'","character"],type:"motion",motion:"goToMark",motionArgs:{toJumplist:true}},{keys:["`","character"],type:"motion",motion:"goToMark",motionArgs:{toJumplist:true}},{keys:["]","`"],type:"motion",motion:"jumpToMark",motionArgs:{forward:true}},{keys:["[","`"],type:"motion",motion:"jumpToMark",motionArgs:{forward:false}},{keys:["]","'"],type:"motion",motion:"jumpToMark",motionArgs:{forward:true,linewise:true}},{keys:["[","'"],type:"motion",motion:"jumpToMark",motionArgs:{forward:false,linewise:true}},{keys:["]","character"],type:"motion",motion:"moveToSymbol",motionArgs:{forward:true,toJumplist:true}},{keys:["[","character"],type:"motion",motion:"moveToSymbol",motionArgs:{forward:false,toJumplist:true}},{keys:["|"],type:"motion",motion:"moveToColumn",motionArgs:{}},{keys:["o"],type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{},context:"visual"},{keys:["d"],type:"operator",operator:"delete"},{keys:["y"],type:"operator",operator:"yank"},{keys:["c"],type:"operator",operator:"change"},{keys:[">"],type:"operator",operator:"indent",operatorArgs:{indentRight:true}},{keys:["<"],type:"operator",operator:"indent",operatorArgs:{indentRight:false}},{keys:["g","~"],type:"operator",operator:"swapcase"},{keys:["n"],type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:true}},{keys:["N"],type:"motion",motion:"findNext",motionArgs:{forward:false,toJumplist:true}},{keys:["x"],type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:true},operatorMotionArgs:{visualLine:false}},{keys:["X"],type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:false},operatorMotionArgs:{visualLine:true}},{keys:["D"],type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:true},operatorMotionArgs:{visualLine:true}},{keys:["Y"],type:"operatorMotion",operator:"yank",motion:"moveToEol",motionArgs:{inclusive:true},operatorMotionArgs:{visualLine:true}},{keys:["C"],type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:true},operatorMotionArgs:{visualLine:true}},{keys:["~"],type:"operatorMotion",operator:"swapcase",operatorArgs:{shouldMoveCursor:true},motion:"moveByCharacters",motionArgs:{forward:true}},{keys:["<C-i>"],type:"action",action:"jumpListWalk",actionArgs:{forward:true}},{keys:["<C-o>"],type:"action",action:"jumpListWalk",actionArgs:{forward:false}},{keys:["<C-e>"],type:"action",action:"scroll",actionArgs:{forward:true,linewise:true}},{keys:["<C-y>"],type:"action",action:"scroll",actionArgs:{forward:false,linewise:true}},{keys:["a"],type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"charAfter"}},{keys:["A"],type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"eol"}},{keys:["i"],type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"inplace"}},{keys:["I"],type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"firstNonBlank"}},{keys:["o"],type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:true}},{keys:["O"],type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:false}},{keys:["v"],type:"action",action:"toggleVisualMode"},{keys:["V"],type:"action",action:"toggleVisualMode",actionArgs:{linewise:true}},{keys:["g","v"],type:"action",action:"reselectLastSelection"},{keys:["J"],type:"action",action:"joinLines",isEdit:true},{keys:["p"],type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true}},{keys:["P"],type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true}},{keys:["r","character"],type:"action",action:"replace",isEdit:true},{keys:["@","character"],type:"action",action:"replayMacro"},{keys:["q","character"],type:"action",action:"enterMacroRecordMode"},{keys:["R"],type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{replace:true}},{keys:["u"],type:"action",action:"undo"},{keys:["<C-r>"],type:"action",action:"redo"},{keys:["m","character"],type:"action",action:"setMark"},{keys:['"',"character"],type:"action",action:"setRegister"},{keys:["z","z"],type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:["z","."],type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["z","t"],type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:["z","<CR>"],type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["z","-"],type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:["z","b"],type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["."],type:"action",action:"repeatLastEdit"},{keys:["<C-a>"],type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:true,backtrack:false}},{keys:["<C-x>"],type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:false,backtrack:false}},{keys:["a","character"],type:"motion",motion:"textObjectManipulation"},{keys:["i","character"],type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:true}},{keys:["/"],type:"search",searchArgs:{forward:true,querySrc:"prompt",toJumplist:true}},{keys:["?"],type:"search",searchArgs:{forward:false,querySrc:"prompt",toJumplist:true}},{keys:["*"],type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",toJumplist:true}},{keys:["#"],type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",toJumplist:true}},{keys:[":"],type:"ex"}];var c=b.Pos;var d=function(){b.defineOption("vimMode",false,function(a8,a9){if(a9){a8.setOption("keyMap","vim");a8.setOption("disableInput",true);b.signal(a8,"vim-mode-change",{mode:"normal"});a8.on("beforeSelectionChange",i);y(a8);b.on(a8.getInputField(),"paste",H(a8))}else{if(a8.state.vim){a8.setOption("keyMap","default");a8.setOption("disableInput",false);a8.off("beforeSelectionChange",i);b.off(a8.getInputField(),"paste",H(a8));a8.state.vim=null}}});function i(a8,bc){var a9=a8.state.vim;if(a9.insertMode||a9.exMode){return}var bb=bc.ranges[0].head;var ba=bc.ranges[0].anchor;if(bb.ch&&bb.ch==a8.doc.getLine(bb.line).length){var bd=c(bb.line,bb.ch-1);bc.update([{anchor:a6(bb,ba)?bd:ba,head:bd}])}}function H(a8){var a9=a8.state.vim;if(!a9.onPasteFn){a9.onPasteFn=function(){if(!a9.insertMode){a8.setCursor(w(a8.getCursor(),0,1));o.enterInsertMode(a8,{},a9)}}}return a9.onPasteFn}var aG=/[\d]/;var ad=[(/\w/),(/[^\w\s]/)],aY=[(/\S/)];function ac(bb,a9){var ba=[];for(var a8=bb;a8<bb+a9;a8++){ba.push(String.fromCharCode(a8))}return ba}var S=ac(65,26);var Y=ac(97,26);var I=ac(48,10);var h="~`!@#$%^&*()_-+=[{}]\\|/?.,<>:;\"'".split("");var aE=["Left","Right","Up","Down","Space","Backspace","Esc","Home","End","PageUp","PageDown","Enter"];var ap=[].concat(S,Y,I,["<",">"]);var k=[].concat(S,Y,I,["-",'"']);function e(a8,a9){return a9>=a8.firstLine()&&a9<=a8.lastLine()}function x(a8){return(/^[a-z]$/).test(a8)}function D(a8){return"()[]{}".indexOf(a8)!=-1}function R(a8){return aG.test(a8)}function t(a8){return(/^[A-Z]$/).test(a8)}function F(a8){return(/^\s*$/).test(a8)}function B(ba,a8){for(var a9=0;a9<a8.length;a9++){if(a8[a9]==ba){return true}}return false}var af={};function av(a9,a8,ba){if(a8===undefined){throw Error("defaultValue is required")}if(!ba){ba="string"}af[a9]={type:ba,defaultValue:a8};at(a9,a8)}function at(a8,ba){var a9=af[a8];if(!a9){throw Error("Unknown option: "+a8)}if(a9.type=="boolean"){if(ba&&ba!==true){throw Error("Invalid argument: "+a8+"="+ba)}else{if(ba!==false){ba=true}}}a9.value=a9.type=="boolean"?!!ba:ba}function n(a8){var a9=af[a8];if(!a9){throw Error("Unknown option: "+a8)}return a9.value}var ab=function(){var bc=100;var be=-1;var bb=0;var ba=0;var a9=new Array(bc);function bd(bf,bh,bi){var bj=be%bc;var bk=a9[bj];function bg(bn){var bm=++be%bc;var bo=a9[bm];if(bo){bo.clear()}a9[bm]=bf.setBookmark(bn)}if(bk){var bl=bk.find();if(bl&&!a6(bl,bh)){bg(bh)}}else{bg(bh)}bg(bi);bb=be;ba=be-bc+1;if(ba<0){ba=0}}function a8(bf,bj){be+=bj;if(be>bb){be=bb}else{if(be<ba){be=ba}}var bk=a9[(bc+be)%bc];if(bk&&!bk.find()){var bi=bj>0?1:-1;var bh;var bg=bf.getCursor();do{be+=bi;bk=a9[(bc+be)%bc];if(bk&&(bh=bk.find())&&!a6(bg,bh)){break}}while(be<bb&&be>ba)}return bk}return{cachedCursor:undefined,add:bd,move:a8}};var g=function(a8){if(a8){return{changes:a8.changes,expectCursorActivityForChange:a8.expectCursorActivityForChange}}return{changes:[],expectCursorActivityForChange:false}};function ai(){this.latestRegister=undefined;this.isPlaying=false;this.isRecording=false;this.onRecordingDone=undefined;this.lastInsertModeChanges=g()}ai.prototype={exitMacroRecordMode:function(){var a8=p.macroModeState;a8.onRecordingDone();a8.onRecordingDone=undefined;a8.isRecording=false},enterMacroRecordMode:function(a8,ba){var a9=p.registerController.getRegister(ba);if(a9){a9.clear();this.latestRegister=ba;this.onRecordingDone=a8.openDialog("(recording)["+ba+"]",null,{bottom:true});this.isRecording=true}}};function y(a8){if(!a8.state.vim){a8.state.vim={inputState:new ak(),lastEditInputState:undefined,lastEditActionCommand:undefined,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},insertMode:false,insertModeRepeat:undefined,visualMode:false,visualLine:false,lastSelection:null}}return a8.state.vim}var p;function s(){p={searchQuery:null,searchIsReversed:false,jumpList:ab(),macroModeState:new ai,lastChararacterSearch:{increment:0,forward:true,selectedCharacter:""},registerController:new T({})};for(var a8 in af){var a9=af[a8];a9.value=a9.defaultValue}}var az={buildKeyMap:function(){},getRegisterController:function(){return p.registerController},resetVimGlobalState_:s,getVimGlobalState_:function(){return p},maybeInitVimState_:y,InsertModeKey:aV,map:function(a9,ba,a8){l.map(a9,ba,a8)},setOption:at,getOption:n,defineOption:av,defineEx:function(a8,ba,a9){if(a8.indexOf(ba)!==0){throw new Error('(Vim.defineEx) "'+ba+'" is not a prefix of "'+a8+'", command not registered')}aL[a8]=a9;l.commandMap_[ba]={name:a8,shortName:ba,type:"api"}},handleKey:function(a8,bb){var bd;var a9=y(a8);var bc=p.macroModeState;if(bc.isRecording){if(bb=="q"){bc.exitMacroRecordMode();a9.inputState=new ak();return}}if(bb=="<Esc>"){a9.inputState=new ak();if(a9.visualMode){aC(a8)}return}if(!a9.visualMode&&!a6(a8.getCursor("head"),a8.getCursor("anchor"))){a9.visualMode=true;a9.visualLine=false;b.signal(a8,"vim-mode-change",{mode:"visual"});a8.on("mousedown",aC)}if(bb!="0"||(bb=="0"&&a9.inputState.getRepeat()===0)){bd=aO.matchCommand(bb,a,a9)}if(!bd){if(R(bb)){a9.inputState.pushRepeatDigit(bb)}if(bc.isRecording){A(bc,bb)}return}if(bd.type=="keyToKey"){for(var ba=0;ba<bd.toKeys.length;ba++){this.handleKey(a8,bd.toKeys[ba])}}else{if(bc.isRecording){A(bc,bb)}aO.processCommand(a8,a9,bd)}},handleEx:function(a8,a9){l.processCommand(a8,a9)}};function ak(){this.prefixRepeat=[];this.motionRepeat=[];this.operator=null;this.operatorArgs=null;this.motion=null;this.motionArgs=null;this.keyBuffer=[];this.registerName=null}ak.prototype.pushRepeatDigit=function(a8){if(!this.operator){this.prefixRepeat=this.prefixRepeat.concat(a8)}else{this.motionRepeat=this.motionRepeat.concat(a8)}};ak.prototype.getRepeat=function(){var a8=0;if(this.prefixRepeat.length>0||this.motionRepeat.length>0){a8=1;if(this.prefixRepeat.length>0){a8*=parseInt(this.prefixRepeat.join(""),10)}if(this.motionRepeat.length>0){a8*=parseInt(this.motionRepeat.join(""),10)}}return a8};function aZ(a9,a8){this.clear();this.keyBuffer=[a9||""];this.insertModeChanges=[];this.linewise=!!a8}aZ.prototype={setText:function(a9,a8){this.keyBuffer=[a9||""];this.linewise=!!a8},pushText:function(a9,a8){if(a8||this.linewise){this.keyBuffer.push("\n");this.linewise=true}this.keyBuffer.push(a9)},pushInsertModeChanges:function(a8){this.insertModeChanges.push(g(a8))},clear:function(){this.keyBuffer=[];this.insertModeChanges=[];this.linewise=false},toString:function(){return this.keyBuffer.join("")}};function T(a8){this.registers=a8;this.unnamedRegister=a8['"']=new aZ()}T.prototype={pushText:function(bb,a9,bd,bc){if(bc&&bd.charAt(0)=="\n"){bd=bd.slice(1)+"\n"}if(bc&&bd.charAt(bd.length-1)!=="\n"){bd+="\n"}var ba=this.isValidRegister(bb)?this.getRegister(bb):null;if(!ba){switch(a9){case"yank":this.registers["0"]=new aZ(bd,bc);break;case"delete":case"change":if(bd.indexOf("\n")==-1){this.registers["-"]=new aZ(bd,bc)}else{this.shiftNumericRegisters_();this.registers["1"]=new aZ(bd,bc)}break}this.unnamedRegister.setText(bd,bc);return}var a8=t(bb);if(a8){ba.append(bd,bc);this.unnamedRegister.append(bd,bc)}else{ba.setText(bd,bc);this.unnamedRegister.setText(bd,bc)}},getRegister:function(a8){if(!this.isValidRegister(a8)){return this.unnamedRegister}a8=a8.toLowerCase();if(!this.registers[a8]){this.registers[a8]=new aZ()}return this.registers[a8]},isValidRegister:function(a8){return a8&&B(a8,k)},shiftNumericRegisters_:function(){for(var a8=9;a8>=2;a8--){this.registers[a8]=this.getRegister(""+(a8-1))}}};var aO={matchCommand:function(bj,bi,bb){var bf=bb.inputState;var bk=bf.keyBuffer.concat(bj);var be=[];var a8;for(var bc=0;bc<bi.length;bc++){var ba=bi[bc];if(aX(bk,ba.keys)){if(bf.operator&&ba.type=="action"){continue}if(ba.keys[bk.length-1]=="character"){a8=bk[bk.length-1];if(a8.length>1){switch(a8){case"<CR>":a8="\n";break;case"<Space>":a8=" ";break;default:continue}}}be.push(ba)}}function bh(bl){if(bk.length<bl.keys.length){bf.keyBuffer.push(bj);return null}else{if(bl.keys[bk.length-1]=="character"){bf.selectedCharacter=a8}bf.keyBuffer=[];return bl}}if(!be.length){bf.keyBuffer=[];return null}else{if(be.length==1){return bh(be[0])}else{var a9=bb.visualMode?"visual":"normal";var bd;for(var bc=0;bc<be.length;bc++){var bg=be[bc];if(bg.context==a9){bd=bg;break}else{if(!bd&&!bg.context){bd=bg}}}return bh(bd)}}},processCommand:function(a8,a9,ba){a9.inputState.repeatOverride=ba.repeatOverride;switch(ba.type){case"motion":this.processMotion(a8,a9,ba);break;case"operator":this.processOperator(a8,a9,ba);break;case"operatorMotion":this.processOperatorMotion(a8,a9,ba);break;case"action":this.processAction(a8,a9,ba);break;case"search":this.processSearch(a8,a9,ba);break;case"ex":case"keyToEx":this.processEx(a8,a9,ba);break;default:break}},processMotion:function(a8,a9,ba){a9.inputState.motion=ba.motion;a9.inputState.motionArgs=aU(ba.motionArgs);this.evalInput(a8,a9)},processOperator:function(a9,ba,bb){var a8=ba.inputState;if(a8.operator){if(a8.operator==bb.operator){a8.motion="expandToLine";a8.motionArgs={linewise:true};this.evalInput(a9,ba);return}else{ba.inputState=new ak()}}a8.operator=bb.operator;a8.operatorArgs=aU(bb.operatorArgs);if(ba.visualMode){this.evalInput(a9,ba)}},processOperatorMotion:function(a8,bb,bc){var ba=bb.visualMode;var a9=aU(bc.operatorMotionArgs);if(a9){if(ba&&a9.visualLine){bb.visualLine=true}}this.processOperator(a8,bb,bc);if(!ba){this.processMotion(a8,bb,bc)}},processAction:function(a9,bb,be){var a8=bb.inputState;var bd=a8.getRepeat();var bc=!!bd;var ba=aU(be.actionArgs)||{};if(a8.selectedCharacter){ba.selectedCharacter=a8.selectedCharacter}if(be.operator){this.processOperator(a9,bb,be)}if(be.motion){this.processMotion(a9,bb,be)}if(be.motion||be.operator){this.evalInput(a9,bb)}ba.repeat=bd||1;ba.repeatIsExplicit=bc;ba.registerName=a8.registerName;bb.inputState=new ak();bb.lastMotion=null;if(be.isEdit){this.recordLastEdit(bb,a8,be)}o[be.action](a9,ba,bb)},processSearch:function(bl,bf,be){if(!bl.getSearchCursor){return}var bg=be.searchArgs.forward;ar(bl).setReversed(!bg);var bh=(bg)?"/":"?";var bj=ar(bl).getQuery();var ba=bl.getScrollInfo();function bd(bo,bm,bn){try{a5(bl,bo,bm,bn)}catch(bp){aW(bl,"Invalid regex: "+bo);return}aO.processMotion(bl,bf,{type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:be.searchArgs.toJumplist}})}function bk(bm){bl.scrollTo(ba.left,ba.top);bd(bm,true,true)}function bc(bm,bo){var bn;try{bn=a5(bl,bo,true,true)}catch(bp){}if(bn){bl.scrollIntoView(a7(bl,!bg,bn),30)}else{aw(bl);bl.scrollTo(ba.left,ba.top)}}function a9(bo,bm,bp){var bn=b.keyName(bo);if(bn=="Esc"||bn=="Ctrl-C"||bn=="Ctrl-["){a5(bl,bj);aw(bl);bl.scrollTo(ba.left,ba.top);b.e_stop(bo);bp();bl.focus()}}switch(be.searchArgs.querySrc){case"prompt":aJ(bl,{onClose:bk,prefix:bh,desc:E,onKeyUp:bc,onKeyDown:a9});break;case"wordUnderCursor":var bb=ao(bl,false,true,false,true);var a8=true;if(!bb){bb=ao(bl,false,true,false,false);a8=false}if(!bb){return}var bi=bl.getLine(bb.start.line).substring(bb.start.ch,bb.end.ch);if(a8){bi="\\b"+bi+"\\b"}else{bi=f(bi)}p.jumpList.cachedCursor=bl.getCursor();bl.setCursor(bb.start);bd(bi,true,false);break}},processEx:function(a8,a9,bc){function bb(bd){l.processCommand(a8,bd)}function ba(bf,be,bg){var bd=b.keyName(bf);if(bd=="Esc"||bd=="Ctrl-C"||bd=="Ctrl-["){b.e_stop(bf);bg();a8.focus()}}if(bc.type=="keyToEx"){l.processCommand(a8,bc.exArgs.input)}else{if(a9.visualMode){aJ(a8,{onClose:bb,prefix:":",value:"'<,'>",onKeyDown:ba})}else{aJ(a8,{onClose:bb,prefix:":",onKeyDown:ba})}}},evalInput:function(bc,bo){var bh=bo.inputState;var bl=bh.motion;var bi=bh.motionArgs||{};var bd=bh.operator;var bs=bh.operatorArgs||{};var bj=bh.registerName;var a9=v(bc.getCursor("head"));var bm=v(bc.getCursor("anchor"));var bb=v(a9);var bg=v(bb);var bp;var be;if(bd){this.recordLastEdit(bo,bh)}if(bh.repeatOverride!==undefined){be=bh.repeatOverride}else{be=bh.getRepeat()}if(be>0&&bi.explicitRepeat){bi.repeatIsExplicit=true}else{if(bi.noRepeat||(!bi.explicitRepeat&&be===0)){be=1;bi.repeatIsExplicit=false}}if(bh.selectedCharacter){bi.selectedCharacter=bs.selectedCharacter=bh.selectedCharacter}bi.repeat=be;bo.inputState=new ak();if(bl){var bn=aK[bl](bc,bi,bo);bo.lastMotion=aK[bl];if(!bn){return}if(bi.toJumplist){var br=p.jumpList;var bf=br.cachedCursor;if(bf){aS(bc,bf,bn);delete br.cachedCursor}else{aS(bc,bg,bn)}}if(bn instanceof Array){bb=bn[0];bp=bn[1]}else{bp=bn}if(!bp){bp=c(bb.line,bb.ch)}if(bo.visualMode){if(ay(bm,a9)&&(a6(bm,bp)||ay(bp,bm))){bm.ch+=1}else{if(ay(a9,bm)&&(a6(bm,bp)||ay(bm,bp))){bm.ch-=1}}a9=bp;bm=(bn instanceof Array)?bb:bm;if(bo.visualLine){if(ay(bm,a9)){bm.ch=0;var a8=bc.lastLine();if(a9.line>a8){a9.line=a8}a9.ch=aF(bc,a9.line)}else{a9.ch=0;bm.ch=aF(bc,bm.line)}}bc.setSelection(bm,a9);aB(bc,bo,"<",ay(bm,a9)?bm:a9);aB(bc,bo,">",ay(bm,a9)?a9:bm)}else{if(!bd){bp=L(bc,bp);bc.setCursor(bp.line,bp.ch)}}}if(bd){var bk=false;bo.lastMotion=null;bs.repeat=be;if(bo.visualMode){bb=bm;bp=a9;bi.inclusive=true}if(ay(bp,bb)){var bq=bb;bb=bp;bp=bq;bk=true}if(bi.inclusive&&!(bo.visualMode&&bk)){bp.ch++}var ba=bi.linewise||(bo.visualMode&&bo.visualLine);if(ba){aR(bc,bb,bp)}else{if(bi.forward){X(bc,bb,bp)}}bs.registerName=bj;bs.linewise=ba;C[bd](bc,bs,bo,bb,bp,bg);if(bo.visualMode){aC(bc)}}},recordLastEdit:function(a9,a8,ba){var bb=p.macroModeState;if(bb.isPlaying){return}a9.lastEditInputState=a8;a9.lastEditActionCommand=ba;bb.lastInsertModeChanges.changes=[];bb.lastInsertModeChanges.expectCursorActivityForChange=false}};var aK={moveToTopLine:function(a8,ba){var a9=aQ(a8).top+ba.repeat-1;return c(a9,aI(a8.getLine(a9)))},moveToMiddleLine:function(a8){var ba=aQ(a8);var a9=Math.floor((ba.top+ba.bottom)*0.5);return c(a9,aI(a8.getLine(a9)))},moveToBottomLine:function(a8,ba){var a9=aQ(a8).bottom-ba.repeat+1;return c(a9,aI(a8.getLine(a9)))},expandToLine:function(a8,a9){var ba=a8.getCursor();return c(ba.line+a9.repeat-1,Infinity)},findNext:function(a8,a9){var bc=ar(a8);var bb=bc.getQuery();if(!bb){return}var ba=!a9.forward;ba=(bc.isReversed())?!ba:ba;au(a8,bb);return a7(a8,ba,bb,a9.repeat)},goToMark:function(ba,a9,a8){var bb=a8.marks[a9.selectedCharacter];if(bb){return bb.find()}return null},moveToOtherHighlightedEnd:function(a9){var ba=v(a9.getCursor("head"));var a8=v(a9.getCursor("anchor"));if(ay(a8,ba)){ba.ch+=1}else{if(ay(ba,a8)){a8.ch-=1}}return([ba,a8])},jumpToMark:function(bf,bb,bc){var ba=bf.getCursor();for(var bd=0;bd<bb.repeat;bd++){var bh=ba;for(var bg in bc.marks){if(!x(bg)){continue}var a9=bc.marks[bg].find();var a8=(bb.forward)?ay(a9,bh):ay(bh,a9);if(a8){continue}if(bb.linewise&&(a9.line==bh.line)){continue}var be=a6(bh,ba);var bi=(bb.forward)?aD(bh,a9,ba):aD(ba,a9,bh);if(be||bi){ba=a9}}}if(bb.linewise){ba=c(ba.line,aI(bf.getLine(ba.line)))}return ba},moveByCharacters:function(a8,a9){var bc=a8.getCursor();var bb=a9.repeat;var ba=a9.forward?bc.ch+bb:bc.ch-bb;return c(bc.line,ba)},moveByLines:function(bd,a9,ba){var bf=bd.getCursor();var bb=bf.ch;switch(ba.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:bb=ba.lastHPos;break;default:ba.lastHPos=bb}var a8=a9.repeat+(a9.repeatOffset||0);var bg=a9.forward?bf.line+a8:bf.line-a8;var bc=bd.firstLine();var be=bd.lastLine();if((bg<bc&&bf.line==bc)||(bg>be&&bf.line==be)){return}if(a9.toFirstChar){bb=aI(bd.getLine(bg));ba.lastHPos=bb}ba.lastHSPos=bd.charCoords(c(bg,bb),"div").left;return c(bg,bb)},moveByDisplayLines:function(bf,ba,bb){var bg=bf.getCursor();switch(bb.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:bb.lastHSPos=bf.charCoords(bg,"div").left}var a8=ba.repeat;var be=bf.findPosV(bg,(ba.forward?a8:-a8),"line",bb.lastHSPos);if(be.hitSide){if(ba.forward){var a9=bf.charCoords(be,"div");var bc={top:a9.top+8,left:bb.lastHSPos};var be=bf.coordsChar(bc,"div")}else{var bd=bf.charCoords(c(bf.firstLine(),0),"div");bd.left=bb.lastHSPos;be=bf.coordsChar(bd,"div")}}bb.lastHPos=be.ch;return be},moveByPage:function(a9,ba){var a8=a9.getCursor();var bc=ba.repeat;a9.moveV((ba.forward?bc:-bc),"page");var bb=a9.getCursor();a9.setCursor(a8);return bb},moveByParagraph:function(a8,ba){var a9=a8.getCursor().line;var bc=ba.repeat;var bd=ba.forward?1:-1;for(var bb=0;bb<bc;bb++){if((!ba.forward&&a9===a8.firstLine())||(ba.forward&&a9==a8.lastLine())){break}a9+=bd;while(a9!==a8.firstLine()&&a9!=a8.lastLine()&&a8.getLine(a9)){a9+=bd}}return c(a9,0)},moveByScroll:function(a8,bb,a9){var bf=a8.getScrollInfo();var bd=null;var bc=bb.repeat;if(!bc){bc=bf.clientHeight/(2*a8.defaultTextHeight())}var be=a8.charCoords(a8.getCursor(),"local");bb.repeat=bc;var bd=aK.moveByDisplayLines(a8,bb,a9);if(!bd){return null}var ba=a8.charCoords(bd,"local");a8.scrollTo(null,bf.top+ba.top-be.top);return bd},moveByWords:function(a8,a9){return al(a8,a9.repeat,!!a9.forward,!!a9.wordEnd,!!a9.bigWord)},moveTillCharacter:function(a9,ba){var bc=ba.repeat;var bb=a1(a9,bc,ba.forward,ba.selectedCharacter);var a8=ba.forward?-1:1;am(a8,ba);if(!bb){return null}bb.ch+=a8;return bb},moveToCharacter:function(a8,a9){var ba=a9.repeat;am(0,a9);return a1(a8,ba,a9.forward,a9.selectedCharacter)||a8.getCursor()},moveToSymbol:function(a8,a9){var ba=a9.repeat;return a2(a8,ba,a9.forward,a9.selectedCharacter)||a8.getCursor()},moveToColumn:function(a8,ba,a9){var bb=ba.repeat;a9.lastHPos=bb-1;a9.lastHSPos=a8.charCoords(a8.getCursor(),"div").left;return V(a8,bb)},moveToEol:function(a8,bc,bb){var bd=a8.getCursor();bb.lastHPos=Infinity;var ba=c(bd.line+bc.repeat-1,Infinity);var a9=a8.clipPos(ba);a9.ch--;bb.lastHSPos=a8.charCoords(a9,"div").left;return ba},moveToFirstNonWhiteSpaceCharacter:function(a8){var a9=a8.getCursor();return c(a9.line,aI(a8.getLine(a9.line)))},moveToMatchedSymbol:function(be){var bg=be.getCursor();var bh=bg.line;var a8=bg.ch;var bd=be.getLine(bh);var a9;var ba=be.getTokenAt(bg).type;var bc=aa(ba);do{a9=bd.charAt(a8++);if(a9&&D(a9)){var bf=be.getTokenAt(c(bh,a8)).type;var bb=aa(bf);if(bc>=bb){break}}}while(a9);if(a9){return ag(be,c(bh,a8-1),a9)}else{return bg}},moveToStartOfLine:function(a8){var a9=a8.getCursor();return c(a9.line,0)},moveToLineOrEdgeOfDocument:function(a8,a9){var ba=a9.forward?a8.lastLine():a8.firstLine();if(a9.repeatIsExplicit){ba=a9.repeat-a8.getOption("firstLineNumber")}return c(ba,aI(a8.getLine(ba)))},textObjectManipulation:function(a9,bb){var ba={"(":")",")":"(","{":"}","}":"{","[":"]","]":"["};var be={"'":true,'"':true};var bd=bb.selectedCharacter;var a8=!bb.textObjectInner;var bc;if(ba[bd]){bc=m(a9,ba[bd],a8)}else{if(be[bd]){bc=aA(a9,bd,a8)}else{if(bd==="W"){bc=ao(a9,a8,true,true)}else{if(bd==="w"){bc=ao(a9,a8,true,false)}else{return null}}}}return[bc.start,bc.end]},repeatLastCharacterSearch:function(ba,bc){var a9=p.lastChararacterSearch;var be=bc.repeat;var bb=bc.forward===a9.forward;var a8=(a9.increment?1:0)*(bb?-1:1);ba.moveH(-a8,"char");bc.inclusive=bb?true:false;var bd=a1(ba,be,bb,a9.selectedCharacter);if(!bd){ba.moveH(a8,"char");return ba.getCursor()}bd.ch+=a8;return bd}};var C={change:function(a9,bd,bb,a8,be){p.registerController.pushText(bd.registerName,"change",a9.getRange(a8,be),bd.linewise);if(bd.linewise){var bc=be.line>a9.lastLine()?"":"\n";a9.replaceRange(bc,a8,be);a9.indentLine(a8.line,"smart");a8.ch=null}else{var bf=a9.getRange(a8,be);if(!F(bf)){var ba=(/\s+$/).exec(bf);if(ba){be=w(be,0,-ba[0].length)}}a9.replaceRange("",a8,be)}o.enterInsertMode(a9,{},a9.state.vim);a9.setCursor(a8)},"delete":function(a9,bb,ba,a8,bc){if(bb.linewise&&bc.line>a9.lastLine()&&a8.line>a9.firstLine()){a8.line--;a8.ch=aF(a9,a8.line)}p.registerController.pushText(bb.registerName,"delete",a9.getRange(a8,bc),bb.linewise);a9.replaceRange("",a8,bc);if(bb.linewise){a9.setCursor(aK.moveToFirstNonWhiteSpaceCharacter(a9))}else{a9.setCursor(a8)}},indent:function(bf,ba,bc,be,bg){var bh=be.line;var a9=bg.line;var a8=(bc.visualMode)?ba.repeat:1;if(ba.linewise){a9--}for(var bd=bh;bd<=a9;bd++){for(var bb=0;bb<a8;bb++){bf.indentLine(bd,ba.indentRight)}}bf.setCursor(be);bf.setCursor(aK.moveToFirstNonWhiteSpaceCharacter(bf))},swapcase:function(bg,a9,be,bf,bh,bd){var bb=bg.getRange(bf,bh);var a8="";for(var ba=0;ba<bb.length;ba++){var bc=bb.charAt(ba);a8+=t(bc)?bc.toLowerCase():bc.toUpperCase()}bg.replaceRange(a8,bf,bh);if(!a9.shouldMoveCursor){bg.setCursor(bd)}},yank:function(a9,bc,bb,a8,bd,ba){p.registerController.pushText(bc.registerName,"yank",a9.getRange(a8,bd),bc.linewise);a9.setCursor(ba)}};var o={jumpListWalk:function(a8,ba,bb){if(bb.visualMode){return}var bd=ba.repeat;var bc=ba.forward;var a9=p.jumpList;var bf=a9.move(a8,bc?bd:-bd);var be=bf?bf.find():undefined;be=be?be:a8.getCursor();a8.setCursor(be)},scroll:function(bg,ba,bc){if(bc.visualMode){return}var a8=ba.repeat||1;var bf=bg.defaultTextHeight();var be=bg.getScrollInfo().top;var bh=bf*a8;var bd=ba.forward?be+bh:be-bh;var bi=v(bg.getCursor());var bb=bg.charCoords(bi,"local");if(ba.forward){if(bd>bb.top){bi.line+=(bd-bb.top)/bf;bi.line=Math.ceil(bi.line);bg.setCursor(bi);bb=bg.charCoords(bi,"local");bg.scrollTo(null,bb.top)}else{bg.scrollTo(null,bd)}}else{var a9=bd+bg.getScrollInfo().clientHeight;if(a9<bb.bottom){bi.line-=(bb.bottom-a9)/bf;bi.line=Math.floor(bi.line);bg.setCursor(bi);bb=bg.charCoords(bi,"local");bg.scrollTo(null,bb.bottom-bg.getScrollInfo().clientHeight)}else{bg.scrollTo(null,bd)}}},scrollToCursor:function(a9,ba){var bd=a9.getCursor().line;var bb=a9.charCoords(c(bd,0),"local");var a8=a9.getScrollInfo().clientHeight;var be=bb.top;var bc=bb.bottom-be;switch(ba.position){case"center":be=be-(a8/2)+bc;break;case"bottom":be=be-a8+bc*1.4;break;case"top":be=be+bc*0.4;break}a9.scrollTo(null,be)},replayMacro:function(a8,a9,ba){var bb=a9.selectedCharacter;var bc=a9.repeat;var bd=p.macroModeState;if(bb=="@"){bb=bd.latestRegister}while(bc--){z(a8,ba,bd,bb)}},enterMacroRecordMode:function(a8,a9){var bb=p.macroModeState;var ba=a9.selectedCharacter;bb.enterMacroRecordMode(a8,ba)},enterInsertMode:function(a8,a9,ba){if(a8.getOption("readOnly")){return}ba.insertMode=true;ba.insertModeRepeat=a9&&a9.repeat||1;var bb=(a9)?a9.insertAt:null;if(bb=="eol"){var bc=a8.getCursor();bc=c(bc.line,aF(a8,bc.line));a8.setCursor(bc)}else{if(bb=="charAfter"){a8.setCursor(w(a8.getCursor(),0,1))}else{if(bb=="firstNonBlank"){a8.setCursor(aK.moveToFirstNonWhiteSpaceCharacter(a8))}}}a8.setOption("keyMap","vim-insert");a8.setOption("disableInput",false);if(a9&&a9.replace){a8.toggleOverwrite(true);a8.setOption("keyMap","vim-replace");b.signal(a8,"vim-mode-change",{mode:"replace"})}else{a8.setOption("keyMap","vim-insert");b.signal(a8,"vim-mode-change",{mode:"insert"})}if(!p.macroModeState.isPlaying){a8.on("change",aT);a8.on("cursorActivity",M);b.on(a8.getInputField(),"keydown",J)}},toggleVisualMode:function(a9,ba,bb){var bd=ba.repeat;var a8=a9.getCursor();var bc;if(!bb.visualMode){a9.on("mousedown",aC);bb.visualMode=true;bb.visualLine=!!ba.linewise;if(bb.visualLine){a8.ch=0;bc=L(a9,c(a8.line+bd-1,aF(a9,a8.line)),true)}else{bc=L(a9,c(a8.line,a8.ch+bd),true)}if(!ba.repeatIsExplicit&&!bb.visualLine){a9.setCursor(bc);a9.setSelection(bc,a8)}else{a9.setSelection(a8,bc)}b.signal(a9,"vim-mode-change",{mode:"visual",subMode:bb.visualLine?"linewise":""})}else{a8=a9.getCursor("anchor");bc=a9.getCursor("head");if(!bb.visualLine&&ba.linewise){bb.visualLine=true;a8.ch=ay(a8,bc)?0:aF(a9,a8.line);bc.ch=ay(a8,bc)?aF(a9,bc.line):0;a9.setSelection(a8,bc);b.signal(a9,"vim-mode-change",{mode:"visual",subMode:"linewise"})}else{if(bb.visualLine&&!ba.linewise){bb.visualLine=false;b.signal(a9,"vim-mode-change",{mode:"visual"})}else{aC(a9)}}}aB(a9,bb,"<",ay(a8,bc)?a8:bc);aB(a9,bb,">",ay(a8,bc)?bc:a8)},reselectLastSelection:function(a8,bb,ba){if(ba.lastSelection){var a9=ba.lastSelection;a8.setSelection(a9.curStart,a9.curEnd);if(a9.visualLine){ba.visualMode=true;ba.visualLine=true}else{ba.visualMode=true;ba.visualLine=false}b.signal(a8,"vim-mode-change",{mode:"visual",subMode:ba.visualLine?"linewise":""})}},joinLines:function(a9,ba,bb){var a8,bd;if(bb.visualMode){a8=a9.getCursor("anchor");bd=a9.getCursor("head");bd.ch=aF(a9,bd.line)-1}else{var bc=Math.max(ba.repeat,2);a8=a9.getCursor();bd=L(a9,c(a8.line+bc-1,Infinity))}var be=0;a9.operation(function(){for(var bh=a8.line;bh<bd.line;bh++){be=aF(a9,a8.line);var bg=c(a8.line+1,aF(a9,a8.line+1));var bi=a9.getRange(a8,bg);bi=bi.replace(/\n\s*/g," ");a9.replaceRange(bi,a8,bg)}var bf=c(a8.line,be);a9.setCursor(bf)})},newLineAndEnterInsertMode:function(a8,a9,ba){ba.insertMode=true;var bb=v(a8.getCursor());if(bb.line===a8.firstLine()&&!a9.after){a8.replaceRange("\n",c(a8.firstLine(),0));a8.setCursor(a8.firstLine(),0)}else{bb.line=(a9.after)?bb.line:bb.line-1;bb.ch=aF(a8,bb.line);a8.setCursor(bb);var bc=b.commands.newlineAndIndentContinueComment||b.commands.newlineAndIndent;bc(a8)}this.enterInsertMode(a8,{repeat:a9.repeat},ba)},paste:function(a9,ba){var bf=v(a9.getCursor());var bc=p.registerController.getRegister(ba.registerName);var be=bc.toString();if(!be){return}if(ba.repeat>1){var be=Array(ba.repeat+1).join(be)}var bd=bc.linewise;if(bd){if(ba.after){be="\n"+be.slice(0,be.length-1);bf.ch=aF(a9,bf.line)}else{bf.ch=0}}else{bf.ch+=ba.after?1:0}a9.replaceRange(be,bf);var bb;var a8;if(bd&&ba.after){bb=c(bf.line+1,aI(a9.getLine(bf.line+1)))}else{if(bd&&!ba.after){bb=c(bf.line,aI(a9.getLine(bf.line)))}else{if(!bd&&ba.after){a8=a9.indexFromPos(bf);bb=a9.posFromIndex(a8+be.length-1)}else{a8=a9.indexFromPos(bf);bb=a9.posFromIndex(a8+be.length)}}}a9.setCursor(bb)},undo:function(a8,a9){a8.operation(function(){ah(a8,b.commands.undo,a9.repeat)();a8.setCursor(a8.getCursor("anchor"))})},redo:function(a8,a9){ah(a8,b.commands.redo,a9.repeat)()},setRegister:function(ba,a8,a9){a9.inputState.registerName=a8.selectedCharacter},setMark:function(a8,a9,ba){var bb=a9.selectedCharacter;aB(a8,ba,bb,a8.getCursor())},replace:function(be,a9,bb){var ba=a9.selectedCharacter;var bd=be.getCursor();var bc;var bf;if(bb.visualMode){bd=be.getCursor("start");bf=be.getCursor("end");bf=be.clipPos(c(bf.line,bf.ch+1))}else{var bg=be.getLine(bd.line);bc=bd.ch+a9.repeat;if(bc>bg.length){bc=bg.length}bf=c(bd.line,bc)}if(ba=="\n"){if(!bb.visualMode){be.replaceRange("",bd,bf)}(b.commands.newlineAndIndentContinueComment||b.commands.newlineAndIndent)(be)}else{var a8=be.getRange(bd,bf);a8=a8.replace(/[^\n]/g,ba);be.replaceRange(a8,bd,bf);if(bb.visualMode){be.setCursor(bd);aC(be)}else{be.setCursor(w(bf,0,-1))}}},incrementNumberToken:function(bi,a9){var bj=bi.getCursor();var be=bi.getLine(bj.line);var bl=/-?\d+/g;var bd;var a8;var bc;var bk;var ba;while((bd=bl.exec(be))!==null){ba=bd[0];a8=bd.index;bc=a8+ba.length;if(bj.ch<bc){break}}if(!a9.backtrack&&(bc<=bj.ch)){return}if(ba){var bh=a9.increase?1:-1;var bb=parseInt(ba)+(bh*a9.repeat);var bg=c(bj.line,a8);var bf=c(bj.line,bc);bk=bb.toString();bi.replaceRange(bk,bg,bf)}else{return}bi.setCursor(c(bj.line,a8+bk.length-1))},repeatLastEdit:function(a9,ba,bb){var a8=bb.lastEditInputState;if(!a8){return}var bc=ba.repeat;if(bc&&ba.repeatIsExplicit){bb.lastEditInputState.repeatOverride=bc}else{bc=bb.lastEditInputState.repeatOverride||bc}r(a9,bb,bc,false)}};function L(a9,bd,bb){var ba=Math.min(Math.max(a9.firstLine(),bd.line),a9.lastLine());var a8=aF(a9,ba)-1;a8=(bb)?a8+1:a8;var bc=Math.min(Math.max(0,bd.ch),a8);return c(ba,bc)}function aU(a9){var a8={};for(var ba in a9){if(a9.hasOwnProperty(ba)){a8[ba]=a9[ba]}}return a8}function w(a9,a8,ba){return c(a9.line+a8,a9.ch+ba)}function aX(ba,a8){for(var a9=0;a9<ba.length;a9++){if(ba[a9]!=a8[a9]&&a8[a9]!="character"){return false}}return true}function ah(a8,a9,ba){return function(){for(var bb=0;bb<ba;bb++){a9(a8)}}}function v(a8){return c(a8.line,a8.ch)}function a6(a9,a8){return a9.ch==a8.ch&&a9.line==a8.line}function ay(a9,a8){if(a9.line<a8.line){return true}if(a9.line==a8.line&&a9.ch<a8.ch){return true}return false}function aD(bb,ba,a9){var bc=ay(bb,ba);var a8=ay(ba,a9);return bc&&a8}function aF(a8,a9){return a8.getLine(a9).length}function j(a8){return a8.split("").reverse().join("")}function aN(a8){if(a8.trim){return a8.trim()}return a8.replace(/^\s+|\s+$/g,"")}function f(a8){return a8.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function aC(a8){a8.off("mousedown",aC);var a9=a8.state.vim;a9.lastSelection={curStart:a9.marks["<"].find(),curEnd:a9.marks[">"].find(),visualMode:a9.visualMode,visualLine:a9.visualLine};a9.visualMode=false;a9.visualLine=false;var ba=a8.getCursor("anchor");var bb=a8.getCursor("head");if(!a6(ba,bb)){a8.setCursor(L(a8,bb))}b.signal(a8,"vim-mode-change",{mode:"normal"})}function X(a9,a8,bd){var bc=a9.getRange(a8,bd);if(/\n\s*$/.test(bc)){var bb=bc.split("\n");bb.pop();var ba;for(var ba=bb.pop();bb.length>0&&ba&&F(ba);ba=bb.pop()){bd.line--;bd.ch=0}if(ba){bd.line--;bd.ch=aF(a9,bd.line)}else{bd.ch=0}}}function aR(a9,a8,ba){a8.ch=0;ba.ch=0;ba.line++}function aI(a9){if(!a9){return 0}var a8=a9.search(/\S/);return a8==-1?a9.length:a8}function ao(bh,bd,br,a9,bs){var bb=bh.getCursor();var bk=bh.getLine(bb.line);var bn=bb.ch;var bm=bk.substring(bn);var bo;if(bs){bo=bm.search(/\w/)}else{bo=bm.search(/\S/)}if(bo==-1){return null}bn+=bo;bm=bk.substring(bn);var bq=bk.substring(0,bn);var bt;if(a9){bt=/^\S+/}else{if((/\w/).test(bk.charAt(bn))){bt=/^\w+/}else{bt=/^[^\w\s]+/}}var be=bt.exec(bm);var bl=bn;var ba=bn+be[0].length;var bc=j(bq);var bi=bt.exec(bc);if(bi){bl-=bi[0].length}if(bd){var bj=bk.substring(ba);var a8=bj.match(/^\s*/)[0].length;if(a8>0){ba+=a8}else{var bg=bc.length-bl;var bf=bc.substring(bg);var bp=bf.match(/^\s*/)[0].length;bl-=bp}}return{start:c(bb.line,bl),end:c(bb.line,ba)}}function aS(a8,a9,ba){if(!a6(a9,ba)){p.jumpList.add(a8,a9,ba)}}function am(a8,a9){p.lastChararacterSearch.increment=a8;p.lastChararacterSearch.forward=a9.forward;p.lastChararacterSearch.selectedCharacter=a9.selectedCharacter}var G={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"};var aH={bracket:{isComplete:function(a8){if(a8.nextCh===a8.symb){a8.depth++;if(a8.depth>=1){return true}}else{if(a8.nextCh===a8.reverseSymb){a8.depth--}}return false}},section:{init:function(a8){a8.curMoveThrough=true;a8.symb=(a8.forward?"]":"[")===a8.symb?"{":"}"},isComplete:function(a8){return a8.index===0&&a8.nextCh===a8.symb}},comment:{isComplete:function(a9){var a8=a9.lastCh==="*"&&a9.nextCh==="/";a9.lastCh=a9.nextCh;return a8}},method:{init:function(a8){a8.symb=(a8.symb==="m"?"{":"}");a8.reverseSymb=a8.symb==="{"?"}":"{"},isComplete:function(a8){if(a8.nextCh===a8.symb){return true}return false}},preprocess:{init:function(a8){a8.index=0},isComplete:function(a9){if(a9.nextCh==="#"){var a8=a9.lineText.match(/#(\w+)/)[1];if(a8==="endif"){if(a9.forward&&a9.depth===0){return true}a9.depth++}else{if(a8==="if"){if(!a9.forward&&a9.depth===0){return true}a9.depth--}}if(a8==="else"&&a9.depth===0){return true}}return false}}};function a2(bh,a9,bc,ba){var bk=v(bh.getCursor());var bi=bc?1:-1;var bb=bc?bh.lineCount():-1;var bg=bk.ch;var bm=bk.line;var bf=bh.getLine(bm);var a8={lineText:bf,nextCh:bf.charAt(bg),lastCh:null,index:bg,symb:ba,reverseSymb:(bc?{")":"(","}":"{"}:{"(":")","{":"}"})[ba],forward:bc,depth:0,curMoveThrough:false};var bd=G[ba];if(!bd){return bk}var bl=aH[bd].init;var bj=aH[bd].isComplete;if(bl){bl(a8)}while(bm!==bb&&a9){a8.index+=bi;a8.nextCh=a8.lineText.charAt(a8.index);if(!a8.nextCh){bm+=bi;a8.lineText=bh.getLine(bm)||"";if(bi>0){a8.index=0}else{var be=a8.lineText.length;a8.index=(be>0)?(be-1):0}a8.nextCh=a8.lineText.charAt(a8.index)}if(bj(a8)){bk.line=bm;bk.ch=a8.index;a9--}}if(a8.nextCh||a8.curMoveThrough){return c(bm,a8.index)}return bk}function a4(bi,bj,bb,bg,bh){var bc=bj.line;var bf=bj.ch;var bm=bi.getLine(bc);var a9=bb?1:-1;var bd=bg?aY:ad;if(bh&&bm==""){bc+=a9;bm=bi.getLine(bc);if(!e(bi,bc)){return null}bf=(bb)?0:bm.length}while(true){if(bh&&bm==""){return{from:0,to:0,line:bc}}var be=(a9>0)?bm.length:-1;var bl=be,bk=be;while(bf!=be){var a8=false;for(var ba=0;ba<bd.length&&!a8;++ba){if(bd[ba].test(bm.charAt(bf))){bl=bf;while(bf!=be&&bd[ba].test(bm.charAt(bf))){bf+=a9}bk=bf;a8=bl!=bk;if(bl==bj.ch&&bc==bj.line&&bk==bl+a9){continue}else{return{from:Math.min(bl,bk+1),to:Math.max(bl,bk),line:bc}}}}if(!a8){bf+=a9}}bc+=a9;if(!e(bi,bc)){return null}bm=bi.getLine(bc);bf=(a9>0)?0:bm.length}throw new Error("The impossible happened.")}function al(bi,a9,bd,bm,bg){var bk=bi.getCursor();var be=v(bk);var bf=[];if(bd&&!bm||!bd&&bm){a9++}var bh=!(bd&&bm);for(var bb=0;bb<a9;bb++){var a8=a4(bi,bk,bd,bg,bh);if(!a8){var ba=aF(bi,bi.lastLine());bf.push(bd?{line:bi.lastLine(),from:ba,to:ba}:{line:0,from:0,to:0});break}bf.push(a8);bk=c(a8.line,bd?(a8.to-1):a8.from)}var bc=bf.length!=a9;var bj=bf[0];var bl=bf.pop();if(bd&&!bm){if(!bc&&(bj.from!=be.ch||bj.line!=be.line)){bl=bf.pop()}return c(bl.line,bl.from)}else{if(bd&&bm){return c(bl.line,bl.to-1)}else{if(!bd&&bm){if(!bc&&(bj.to!=be.ch||bj.line!=be.line)){bl=bf.pop()}return c(bl.line,bl.to)}else{return c(bl.line,bl.from)}}}}function a1(bd,a9,bb,bc){var bf=bd.getCursor();var a8=bf.ch;var be;for(var ba=0;ba<a9;ba++){var bg=bd.getLine(bf.line);be=aP(a8,bg,bc,bb,true);if(be==-1){return null}a8=be}return c(bd.getCursor().line,be)}function V(a8,ba){var a9=a8.getCursor().line;return L(a8,c(a9,ba-1))}function aB(a8,a9,ba,bb){if(!B(ba,ap)){return}if(a9.marks[ba]){a9.marks[ba].clear()}a9.marks[ba]=a8.setBookmark(bb)}function aP(bd,a9,bc,ba,bb){var a8;if(ba){a8=a9.indexOf(bc,bd+1);if(a8!=-1&&!bb){a8-=1}}else{a8=a9.lastIndexOf(bc,bd-1);if(a8!=-1&&!bb){a8+=1}}return a8}function aa(a8){return(a8==="string"||a8==="comment")?1:0}function ag(bk,bl,ba){var bn=bl.line;var a9=bl.ch;ba=ba?ba:bk.getLine(bn).charAt(a9);var bm=bk.getTokenAt(c(bn,a9+1)).type;var bo=aa(bm);var bc=({"(":")",")":"(","[":"]","]":"[","{":"}","}":"{"})[ba];if(!bc){return bl}var bj=({"(":1,"{":1,"[":1})[ba]||-1;var bb=bj===1?bk.lineCount():-1;var be=1,a8=ba,bg=a9,bi=bk.getLine(bn);while(bn!==bb&&be>0){bg+=bj;a8=bi.charAt(bg);if(!a8){bn+=bj;bi=bk.getLine(bn)||"";if(bj>0){bg=0}else{var bh=bi.length;bg=(bh>0)?(bh-1):0}a8=bi.charAt(bg)}var bf=bk.getTokenAt(c(bn,bg+1)).type;var bd=aa(bf);if(bo>=bd){if(a8===ba){be++}else{if(a8===bc){be--}}}}if(a8){return c(bn,bg)}return bl}function m(a9,bd,a8){var bc=v(a9.getCursor());var ba=ag(a9,bc,bd);var be=ag(a9,ba);if((be.line==ba.line&&be.ch>ba.ch)||(be.line>ba.line)){var bb=be;be=ba;ba=bb}if(a8){ba.ch+=1}else{be.ch+=1}return{start:be,end:ba}}function aA(bg,ba,bf){var bh=v(bg.getCursor());var bi=bg.getLine(bh.line);var be=bi.split("");var a9,bb,bc,bd;var a8=be.indexOf(ba);if(bh.ch<a8){bh.ch=a8}else{if(a8<bh.ch&&be[bh.ch]==ba){bb=bh.ch;--bh.ch}}if(be[bh.ch]==ba&&!bb){a9=bh.ch+1}else{for(bc=bh.ch;bc>-1&&!a9;bc--){if(be[bc]==ba){a9=bc+1}}}if(a9&&!bb){for(bc=a9,bd=be.length;bc<bd&&!bb;bc++){if(be[bc]==ba){bb=bc}}}if(!a9||!bb){return{start:bh,end:bh}}if(bf){--a9;++bb}return{start:c(bh.line,a9),end:c(bh.line,bb)}}av("pcre",true,"boolean");function O(){}O.prototype={getQuery:function(){return p.query},setQuery:function(a8){p.query=a8},getOverlay:function(){return this.searchOverlay},setOverlay:function(a8){this.searchOverlay=a8},isReversed:function(){return p.isReversed},setReversed:function(a8){p.isReversed=a8}};function ar(a8){var a9=a8.state.vim;return a9.searchState_||(a9.searchState_=new O())}function N(a8,bb,bc,a9,ba){if(a8.openDialog){a8.openDialog(bb,a9,{bottom:true,value:ba.value,onKeyDown:ba.onKeyDown,onKeyUp:ba.onKeyUp})}else{a9(prompt(bc,""))}}function W(bb){var a9=false;var ba=[];for(var a8=0;a8<bb.length;a8++){var bc=bb.charAt(a8);if(!a9&&bc=="/"){ba.push(a8)}a9=!a9&&(bc=="\\")}return ba}function a0(bf){var bg=["|","(",")","{"];var bc=["}"];var bd=false;var a9=[];for(var ba=-1;ba<bf.length;ba++){var be=bf.charAt(ba)||"";var a8=bf.charAt(ba+1)||"";var bb=(bg.indexOf(a8)!=-1);if(bd){if(be!=="\\"||!bb){a9.push(be)}bd=false}else{if(be==="\\"){bd=true;if(bc.indexOf(a8)!=-1){bb=true}if(!bb||a8==="\\"){a9.push(be)}}else{a9.push(be);if(bb&&a8!=="\\"){a9.push("\\")}}}}return a9.join("")}function a3(bb){var ba=false;var a8=[];for(var a9=-1;a9<bb.length;a9++){var bd=bb.charAt(a9)||"";var bc=bb.charAt(a9+1)||"";if(ba){a8.push(bd);ba=false}else{if(bd==="\\"){ba=true;if((R(bc)||bc==="$")){a8.push("$")}else{if(bc!=="/"&&bc!=="\\"){a8.push("\\")}}}else{if(bd==="$"){a8.push("$")}a8.push(bd);if(bc==="/"){a8.push("\\")}}}}return a8.join("")}function Q(ba){var a9=new b.StringStream(ba);var a8=[];while(!a9.eol()){while(a9.peek()&&a9.peek()!="\\"){a8.push(a9.next())}if(a9.match("\\/",true)){a8.push("/")}else{if(a9.match("\\\\",true)){a8.push("\\")}else{a8.push(a9.next())}}}return a8.join("")}function aj(bf,a9,bb){if(bf instanceof RegExp){return bf}var bd=W(bf);var ba;var a8;if(!bd.length){ba=bf}else{ba=bf.substring(0,bd[0]);var bc=bf.substring(bd[0]);a8=(bc.indexOf("i")!=-1)}if(!ba){return null}if(!n("pcre")){ba=a0(ba)}if(bb){a9=(/^[^A-Z]*$/).test(ba)}var be=new RegExp(ba,(a9||a8)?"i":undefined);return be}function aW(a8,a9){if(a8.openNotification){a8.openNotification('<span style="color: red">'+a9+"</span>",{bottom:true,duration:5000})}else{alert(a9)}}function aq(a9,ba){var a8="";if(a9){a8+='<span style="font-family: monospace">'+a9+"</span>"}a8+='<input type="text"/> <span style="color: #888">';if(ba){a8+='<span style="color: #888">';a8+=ba;a8+="</span>"}return a8}var E="(Javascript regexp)";function aJ(a9,ba){var bb=(ba.prefix||"")+" "+(ba.desc||"");var a8=aq(ba.prefix,ba.desc);N(a9,a8,bb,ba.onClose,ba)}function K(a9,a8){if(a9 instanceof RegExp&&a8 instanceof RegExp){var bb=["global","multiline","ignoreCase","source"];for(var ba=0;ba<bb.length;ba++){var bc=bb[ba];if(a9[bc]!==a8[bc]){return false}}return true}return false}function a5(a8,bd,a9,ba){if(!bd){return}var bc=ar(a8);var bb=aj(bd,!!a9,!!ba);if(!bb){return}au(a8,bb);if(K(bb,bc.getQuery())){return bb}bc.setQuery(bb);return bb}function ax(a9){if(a9.source.charAt(0)=="^"){var a8=true}return{token:function(bb){if(a8&&!bb.sol()){bb.skipToEnd();return}var ba=bb.match(a9,false);if(ba){if(ba[0].length==0){bb.next();return"searching"}if(!bb.sol()){bb.backUp(1);if(!a9.exec(bb.next()+ba[0])){bb.next();return null}}bb.match(a9);return"searching"}while(!bb.eol()){bb.next();if(bb.match(a9,false)){break}}},query:a9}}function au(a8,ba){var a9=ar(a8).getOverlay();if(!a9||ba!=a9.query){if(a9){a8.removeOverlay(a9)}a9=ax(ba);a8.addOverlay(a9);ar(a8).setOverlay(a9)}}function a7(a8,a9,bb,ba){if(ba===undefined){ba=1}return a8.operation(function(){var bf=a8.getCursor();var be=a8.getSearchCursor(bb,bf);for(var bc=0;bc<ba;bc++){var bd=be.find(a9);if(bc==0&&bd&&a6(be.from(),bf)){bd=be.find(a9)}if(!bd){be=a8.getSearchCursor(bb,(a9)?c(a8.lastLine()):c(a8.firstLine(),0));if(!be.find(a9)){return}}}return be.from()})}function aw(a8){a8.removeOverlay(ar(a8).getOverlay());ar(a8).setOverlay(null)}function P(ba,a9,a8){if(typeof ba!="number"){ba=ba.line}if(a9 instanceof Array){return B(ba,a9)}else{if(a8){return(ba>=a9&&ba<=a8)}else{return ba==a9}}}function aQ(a8){var bb=a8.getScrollInfo();var ba=6;var be=10;var bd=a8.coordsChar({left:0,top:ba+bb.top},"local");var a9=bb.clientHeight-be+bb.top;var bc=a8.coordsChar({left:0,top:a9},"local");return{top:bd.line,bottom:bc.line}}var u=[{name:"map"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"set"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s"},{name:"nohlsearch",shortName:"noh"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg"}];d.ExCommandDispatcher=function(){this.buildCommandMap_()};d.ExCommandDispatcher.prototype={processCommand:function(bg,bf){var bb=bg.state.vim;if(bb.visualMode){aC(bg)}var a8=new b.StringStream(bf);var a9={};a9.input=bf;try{this.parseInput_(bg,a8,a9)}catch(be){aW(bg,be);throw be}var bd;if(!a9.commandName){if(a9.line!==undefined){bd="move"}}else{var ba=this.matchCommand_(a9.commandName);if(ba){bd=ba.name;this.parseCommandArgs_(a8,a9,ba);if(ba.type=="exToKey"){for(var bc=0;bc<ba.toKeys.length;bc++){b.Vim.handleKey(bg,ba.toKeys[bc])}return}else{if(ba.type=="exToEx"){this.processCommand(bg,ba.toInput);return}}}}if(!bd){aW(bg,'Not an editor command ":'+bf+'"');return}try{aL[bd](bg,a9)}catch(be){aW(bg,be);throw be}},parseInput_:function(a9,ba,a8){ba.eatWhile(":");if(ba.eat("%")){a8.line=a9.firstLine();a8.lineEnd=a9.lastLine()}else{a8.line=this.parseLineSpec_(a9,ba);if(a8.line!==undefined&&ba.eat(",")){a8.lineEnd=this.parseLineSpec_(a9,ba)}}var bb=ba.match(/^(\w+)/);if(bb){a8.commandName=bb[1]}else{a8.commandName=ba.match(/.*/)[0]}return a8},parseLineSpec_:function(a8,a9){var ba=a9.match(/^(\d+)/);if(ba){return parseInt(ba[1],10)-1}switch(a9.next()){case".":return a8.getCursor().line;case"$":return a8.lastLine();case"'":var bb=a8.state.vim.marks[a9.next()];if(bb&&bb.find()){return bb.find().line}throw new Error("Mark not set");default:a9.backUp(1);return undefined}},parseCommandArgs_:function(a9,bc,bb){if(a9.eol()){return}bc.argString=a9.match(/.*/)[0];var ba=bb.argDelimiter||/\s+/;var a8=aN(bc.argString).split(ba);if(a8.length&&a8[0]){bc.args=a8}},matchCommand_:function(a9){for(var a8=a9.length;a8>0;a8--){var ba=a9.substring(0,a8);if(this.commandMap_[ba]){var bb=this.commandMap_[ba];if(bb.name.indexOf(a9)===0){return bb}}}return null},buildCommandMap_:function(){this.commandMap_={};for(var a9=0;a9<u.length;a9++){var ba=u[a9];var a8=ba.shortName||ba.name;this.commandMap_[a8]=ba}},map:function(a9,bc,a8){if(a9!=":"&&a9.charAt(0)==":"){if(a8){throw Error("Mode not supported for ex mappings")}var bb=a9.substring(1);if(bc!=":"&&bc.charAt(0)==":"){this.commandMap_[bb]={name:bb,type:"exToEx",toInput:bc.substring(1),user:true}}else{this.commandMap_[bb]={name:bb,type:"exToKey",toKeys:U(bc),user:true}}}else{if(bc!=":"&&bc.charAt(0)==":"){var ba={keys:U(a9),type:"keyToEx",exArgs:{input:bc.substring(1)},user:true};if(a8){ba.context=a8}a.unshift(ba)}else{var ba={keys:U(a9),type:"keyToKey",toKeys:U(bc),user:true};if(a8){ba.context=a8}a.unshift(ba)}}},unmap:function(a9,a8){var bd=function(bf,be){if(bf===be){return true}if(bf==null||be==null){return true}if(bf.length!=be.length){return false}for(var bg=0;bg<bf.length;bg++){if(bf[bg]!==be[bg]){return false}}return true};if(a9!=":"&&a9.charAt(0)==":"){if(a8){throw Error("Mode not supported for ex mappings")}var bb=a9.substring(1);if(this.commandMap_[bb]&&this.commandMap_[bb].user){delete this.commandMap_[bb];return}}else{var bc=U(a9);for(var ba=0;ba<a.length;ba++){if(bd(bc,a[ba].keys)&&a[ba].context===a8&&a[ba].user){a.splice(ba,1);return}}}throw Error("No such mapping.")}};function U(bb){var a9,a8;var ba=[];while(bb){a8=(/<\w+-.+?>|<\w+>|./).exec(bb);if(a8===null){break}a9=a8[0];bb=bb.substring(a8.index+a9.length);ba.push(a9)}return ba}var aL={map:function(a8,bb,a9){var ba=bb.args;if(!ba||ba.length<2){if(a8){aW(a8,"Invalid mapping: "+bb.input)}return}l.map(ba[0],ba[1],a9)},nmap:function(a8,a9){this.map(a8,a9,"normal")},vmap:function(a8,a9){this.map(a8,a9,"visual")},unmap:function(a8,bb,a9){var ba=bb.args;if(!ba||ba.length<1){if(a8){aW(a8,"No such mapping: "+bb.input)}return}l.unmap(ba[0],a9)},move:function(a8,a9){aO.processCommand(a8,a8.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true},repeatOverride:a9.line+1})},set:function(bg,bd){var ba=bd.args;if(!ba||ba.length<1){if(bg){aW(bg,"Invalid mapping: "+bd.input)}return}var be=ba[0].split("=");var a9=be[0];var bf=be[1];var bc=false;if(a9.charAt(a9.length-1)=="?"){if(bf){throw Error("Trailing characters: "+bd.argString)}a9=a9.substring(0,a9.length-1);bc=true}if(bf===undefined&&a9.substring(0,2)=="no"){a9=a9.substring(2);bf=false}var bb=af[a9]&&af[a9].type=="boolean";if(bb&&bf==undefined){bf=true}if(!bb&&!bf||bc){var a8=n(a9);if(a8===true||a8===false){aW(bg," "+(a8?"":"no")+a9)}else{aW(bg,"  "+a9+"="+a8)}}else{at(a9,bf)}},registers:function(bd,a9){var bf=a9.args;var bc=p.registerController.registers;var ba="----------Registers----------<br><br>";if(!bf){for(var a8 in bc){var bg=bc[a8].toString();if(bg.length){ba+='"'+a8+"    "+bg+"<br>"}}}else{var a8;bf=bf.join("");for(var bb=0;bb<bf.length;bb++){a8=bf.charAt(bb);if(!p.registerController.isValidRegister(a8)){continue}var be=bc[a8]||new aZ();ba+='"'+a8+"    "+be.text+"<br>"}}aW(bd,ba)},sort:function(bh,br){var bi,bb,a9,ba;function bc(){if(br.argString){var bv=new b.StringStream(br.argString);if(bv.eat("!")){bi=true}if(bv.eol()){return}if(!bv.eatSpace()){return"Invalid arguments"}var bx=bv.match(/[a-z]+/);if(bx){bx=bx[0];bb=bx.indexOf("i")!=-1;a9=bx.indexOf("u")!=-1;var bu=bx.indexOf("d")!=-1&&1;var bw=bx.indexOf("x")!=-1&&1;var bt=bx.indexOf("o")!=-1&&1;if(bu+bw+bt>1){return"Invalid arguments"}ba=bu&&"decimal"||bw&&"hex"||bt&&"octal"}if(bv.eatSpace()&&bv.match(/\/.*\//)){"patterns not supported"}}}var bd=bc();if(bd){aW(bh,bd+": "+br.argString);return}var bm=br.line||bh.firstLine();var bq=br.lineEnd||br.line||bh.lastLine();if(bm==bq){return}var bg=c(bm,0);var bo=c(bq,aF(bh,bq));var bl=bh.getRange(bg,bo).split("\n");var be=(ba=="decimal")?/(-?)([\d]+)/:(ba=="hex")?/(-?)(?:0x)?([0-9a-f]+)/i:(ba=="octal")?/([0-7]+)/:null;var bf=(ba=="decimal")?10:(ba=="hex")?16:(ba=="octal")?8:null;var bj=[],bn=[];if(ba){for(var bp=0;bp<bl.length;bp++){if(be.exec(bl[bp])){bj.push(bl[bp])}else{bn.push(bl[bp])}}}else{bn=bl}function bs(bu,bt){if(bi){var bv;bv=bu;bu=bt;bt=bv}if(bb){bu=bu.toLowerCase();bt=bt.toLowerCase()}var bx=ba&&be.exec(bu);var bw=ba&&be.exec(bt);if(!bx){return bu<bt?-1:1}bx=parseInt((bx[1]+bx[2]).toLowerCase(),bf);bw=parseInt((bw[1]+bw[2]).toLowerCase(),bf);return bx-bw}bj.sort(bs);bn.sort(bs);bl=(!bi)?bn.concat(bj):bj.concat(bn);if(a9){var bk=bl;var a8;bl=[];for(var bp=0;bp<bk.length;bp++){if(bk[bp]!=a8){bl.push(bk[bp])}a8=bk[bp]}}bh.replaceRange(bl.join("\n"),bg,bo)},substitute:function(bm,bb){if(!bm.getSearchCursor){throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.")}var a9=bb.argString;var bl=W(a9);if(bl[0]!==0){aW(bm,"Substitutions should be of the form :s/pattern/replace/");return}var bo=a9.substring(bl[0]+1,bl[1]);var bf="";var bg;var bh;var a8=false;if(bl[1]){bf=a9.substring(bl[1]+1,bl[2]);if(n("pcre")){bf=Q(bf)}else{bf=a3(bf)}}if(bl[2]){var be=a9.substring(bl[2]+1).split(" ");bg=be[0];bh=parseInt(be[1])}if(bg){if(bg.indexOf("c")!=-1){a8=true;bg.replace("c","")}bo=bo+"/"+bg}if(bo){try{a5(bm,bo,true,true)}catch(bj){aW(bm,"Invalid regex: "+bo);return}}var ba=ar(bm);var bk=ba.getQuery();var bd=(bb.line!==undefined)?bb.line:bm.getCursor().line;var bc=bb.lineEnd||bd;if(bh){bd=bc;bc=bd+bh-1}var bi=L(bm,c(bd,0));var bn=bm.getSearchCursor(bk,bi);aM(bm,a8,bd,bc,bn,bk,bf)},redo:b.commands.redo,undo:b.commands.undo,write:function(a8){if(b.commands.save){b.commands.save(a8)}else{a8.save()}},nohlsearch:function(a8){aw(a8)},delmarks:function(bi,bd){if(!bd.argString||!aN(bd.argString)){aW(bi,"Argument required");return}var a8=bi.state.vim;var bj=new b.StringStream(aN(bd.argString));while(!bj.eol()){bj.eatSpace();var bg=bj.pos;if(!bj.match(/[a-zA-Z]/,false)){aW(bi,"Invalid argument: "+bd.argString.substring(bg));return}var ba=bj.next();if(bj.match("-",true)){if(!bj.match(/[a-zA-Z]/,false)){aW(bi,"Invalid argument: "+bd.argString.substring(bg));return}var bb=ba;var bf=bj.next();if(x(bb)&&x(bf)||t(bb)&&t(bf)){var a9=bb.charCodeAt(0);var bh=bf.charCodeAt(0);if(a9>=bh){aW(bi,"Invalid argument: "+bd.argString.substring(bg));return}for(var be=0;be<=bh-a9;be++){var bc=String.fromCharCode(a9+be);delete a8.marks[bc]}}else{aW(bi,"Invalid argument: "+bb+"-");return}}else{delete a8.marks[ba]}}}};var l=new d.ExCommandDispatcher();function aM(bl,a9,bg,bd,ba,bi,bc){bl.state.vim.exMode=true;var be=false;var bk=ba.from();function bh(){bl.operation(function(){while(!be){bb();bf()}bj()})}function bb(){var bn=bl.getRange(ba.from(),ba.to());var bm=bn.replace(bi,bc);ba.replace(bm)}function bf(){var bm=ba.findNext();if(!bm){be=true}else{if(P(ba.from(),bg,bd)){bl.scrollIntoView(ba.from(),30);bl.setSelection(ba.from(),ba.to());bk=ba.from();be=false}else{be=true}}}function bj(bn){if(bn){bn()}bl.focus();if(bk){bl.setCursor(bk);var bm=bl.state.vim;bm.exMode=false;bm.lastHPos=bm.lastHSPos=bk.ch}}function a8(bo,bm,bp){b.e_stop(bo);var bn=b.keyName(bo);switch(bn){case"Y":bb();bf();break;case"N":bf();break;case"A":bl.operation(bh);break;case"L":bb();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":bj(bp);break}if(be){bj(bp)}}bf();if(be){aW(bl,"No matches for "+bi.source);return}if(!a9){bh();return}aJ(bl,{prefix:"replace with <strong>"+bc+"</strong> (y/n/a/q/l)",onKeyDown:a8})}function an(){function ba(be,bd){var bc=be;if(t(bc)&&bd=="Ctrl"){bc=bc.toLowerCase()}if(bd){bc=bd.charAt(0)+"-"+bc}var bf=({Enter:"CR",Backspace:"BS",Delete:"Del"})[bc];bc=bf?bf:bc;bc=bc.length>1?"<"+bc+">":bc;return bc}function a9(bc){return function(bd){b.Vim.handleKey(bd,bc)}}var a8={nofallthrough:true,style:"fat-cursor"};function bb(bh,bd){for(var bg=0;bg<bh.length;bg++){var bf=bh[bg];if(!bd&&bf.length==1){bf="'"+bf+"'"}var bc=ba(bh[bg],bd);var be=bd?bd+"-"+bf:bf;a8[be]=a9(bc)}}bb(S);bb(Y);bb(S,"Ctrl");bb(h);bb(h,"Ctrl");bb(I);bb(I,"Ctrl");bb(aE);bb(aE,"Ctrl");return a8}b.keyMap.vim=an();function q(a8){var a9=a8.state.vim;var bb=p.macroModeState;var ba=bb.isPlaying;if(!ba){a8.off("change",aT);a8.off("cursorActivity",M);b.off(a8.getInputField(),"keydown",J)}if(!ba&&a9.insertModeRepeat>1){r(a8,a9,a9.insertModeRepeat-1,true);a9.lastEditInputState.repeatOverride=a9.insertModeRepeat}delete a9.insertModeRepeat;a8.setCursor(a8.getCursor().line,a8.getCursor().ch-1);a9.insertMode=false;a8.setOption("keyMap","vim");a8.setOption("disableInput",true);a8.toggleOverwrite(false);b.signal(a8,"vim-mode-change",{mode:"normal"});if(bb.isRecording){Z(bb)}}b.keyMap["vim-insert"]={Esc:q,"Ctrl-[":q,"Ctrl-C":q,"Ctrl-N":"autocomplete","Ctrl-P":"autocomplete",Enter:function(a8){var a9=b.commands.newlineAndIndentContinueComment||b.commands.newlineAndIndent;a9(a8)},fallthrough:["default"]};b.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"]};function z(bf,ba,bb,a8){var bh=p.registerController.getRegister(a8);var a9=bh.keyBuffer;var be=0;bb.isPlaying=true;for(var bc=0;bc<a9.length;bc++){var bi=a9[bc];var bd,bg;while(bi){bd=(/<\w+-.+?>|<\w+>|./).exec(bi);bg=bd[0];bi=bi.substring(bd.index+bg.length);b.Vim.handleKey(bf,bg);if(ba.insertMode){ae(bf,bh.insertModeChanges[be++].changes,1);q(bf)}}}bb.isPlaying=false}function A(bb,a8){if(bb.isPlaying){return}var ba=bb.latestRegister;var a9=p.registerController.getRegister(ba);if(a9){a9.pushText(a8)}}function Z(ba){if(ba.isPlaying){return}var a9=ba.latestRegister;var a8=p.registerController.getRegister(a9);if(a8){a8.pushInsertModeChanges(ba.lastInsertModeChanges)}}function aT(a9,a8){var bb=p.macroModeState;var ba=bb.lastInsertModeChanges;if(!bb.isPlaying){while(a8){ba.expectCursorActivityForChange=true;if(a8.origin=="+input"||a8.origin=="paste"||a8.origin===undefined){var bc=a8.text.join("\n");ba.changes.push(bc)}a8=a8.next}}}function M(){var a9=p.macroModeState;if(a9.isPlaying){return}var a8=a9.lastInsertModeChanges;if(a8.expectCursorActivityForChange){a8.expectCursorActivityForChange=false}else{a8.changes=[]}}function aV(a8){this.keyName=a8}function J(bc){var bb=p.macroModeState;var ba=bb.lastInsertModeChanges;var a9=b.keyName(bc);function a8(){ba.changes.push(new aV(a9));return true}if(a9.indexOf("Delete")!=-1||a9.indexOf("Backspace")!=-1){b.lookupKey(a9,["vim-insert"],a8)}}function r(bg,bb,a9,a8){var bd=p.macroModeState;bd.isPlaying=true;var bh=!!bb.lastEditActionCommand;var be=bb.inputState;function ba(){if(bh){aO.processAction(bg,bb,bb.lastEditActionCommand)}else{aO.evalInput(bg,bb)}}function bf(bj){if(bd.lastInsertModeChanges.changes.length>0){bj=!bb.lastEditActionCommand?1:bj;var bi=bd.lastInsertModeChanges;bd.lastInsertModeChanges={};ae(bg,bi.changes,bj);bd.lastInsertModeChanges=bi}}bb.inputState=bb.lastEditInputState;if(bh&&bb.lastEditActionCommand.interlaceInsertRepeat){for(var bc=0;bc<a9;bc++){ba();bf(1)}}else{if(!a8){ba()}bf(a9)}bb.inputState=be;if(bb.insertMode&&!a8){q(bg)}bd.isPlaying=false}function ae(a8,bb,bc){function bd(bg){if(typeof bg=="string"){b.commands[bg](a8)}else{bg(a8)}return true}for(var ba=0;ba<bc;ba++){for(var a9=0;a9<bb.length;a9++){var bf=bb[a9];if(bf instanceof aV){b.lookupKey(bf.keyName,["vim-insert"],bd)}else{var be=a8.getCursor();a8.replaceRange(bf,be,be)}}}}s();return az};b.Vim=d()});