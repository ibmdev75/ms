(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(z){var s=z.Pos;var g="http://www.w3.org/2000/svg";function k(G,H){this.mv=G;this.type=H;this.classes=H=="left"?{chunk:"CodeMirror-merge-l-chunk",start:"CodeMirror-merge-l-chunk-start",end:"CodeMirror-merge-l-chunk-end",insert:"CodeMirror-merge-l-inserted",del:"CodeMirror-merge-l-deleted",connect:"CodeMirror-merge-l-connect"}:{chunk:"CodeMirror-merge-r-chunk",start:"CodeMirror-merge-r-chunk-start",end:"CodeMirror-merge-r-chunk-end",insert:"CodeMirror-merge-r-inserted",del:"CodeMirror-merge-r-deleted",connect:"CodeMirror-merge-r-connect"}}k.prototype={constructor:k,init:function(I,H,G){this.edit=this.mv.edit;this.orig=z(I,w({value:H,readOnly:true},w(G)));this.diff=b(o(H),o(G.value));this.diffOutOfDate=false;this.showDifferences=G.showDifferences!==false;this.forceUpdate=B(this);D(this,true,false);p(this)},setShowDifferences:function(G){G=G!==false;if(G!=this.showDifferences){this.showDifferences=G;this.forceUpdate("full")}}};function B(G){var H={from:0,to:0,marked:[]};var M={from:0,to:0,marked:[]};var L;function K(N){if(N=="full"){if(G.svg){v(G.svg)}v(G.copyButtons);c(G.edit,H.marked,G.classes);c(G.orig,M.marked,G.classes);H.from=H.to=M.from=M.to=0}if(G.diffOutOfDate){G.diff=b(G.orig.getValue(),G.edit.getValue());G.diffOutOfDate=false;z.signal(G.edit,"updateDiff",G.diff)}if(G.showDifferences){u(G.edit,G.diff,H,DIFF_INSERT,G.classes);u(G.orig,G.diff,M,DIFF_DELETE,G.classes)}q(G)}function J(N){clearTimeout(L);L=setTimeout(K,N==true?250:100)}function I(){if(!G.diffOutOfDate){G.diffOutOfDate=true;H.from=H.to=M.from=M.to=0}J(true)}G.edit.on("change",I);G.orig.on("change",I);G.edit.on("markerAdded",J);G.edit.on("markerCleared",J);G.orig.on("markerAdded",J);G.orig.on("markerCleared",J);G.edit.on("viewportChange",J);G.orig.on("viewportChange",J);K();return K}function p(G){G.edit.on("scroll",function(){C(G,DIFF_INSERT)&&q(G)});G.orig.on("scroll",function(){C(G,DIFF_DELETE)&&q(G)})}function C(S,K){if(S.diffOutOfDate){return false}if(!S.lockScroll){return true}var L,N,I=+new Date;if(K==DIFF_INSERT){L=S.edit;N=S.orig}else{L=S.orig;N=S.edit}if(L.state.scrollSetBy==S&&(L.state.scrollSetAt||0)+50>I){return false}var G=L.getScrollInfo(),H=0.5*G.clientHeight,Q=G.top+H;var W=L.lineAtHeight(Q,"local");var U=F(S.diff,W,K==DIFF_INSERT);var X=r(L,K==DIFF_INSERT?U.edit:U.orig);var P=r(N,K==DIFF_INSERT?U.orig:U.edit);var O=(Q-X.top)/(X.bot-X.top);var J=(P.top-H)+O*(P.bot-P.top);var M,R;if(J>G.top&&(R=G.top/H)<1){J=J*R+G.top*(1-R)}else{if((M=G.height-G.clientHeight-G.top)<H){var V=N.getScrollInfo();var T=V.height-V.clientHeight-J;if(T>M&&(R=M/H)<1){J=J*R+(V.height-V.clientHeight-M)*(1-R)}}}N.scrollTo(G.left,J);N.state.scrollSetAt=I;N.state.scrollSetBy=S;return true}function r(G,H){var I=H.after;if(I==null){I=G.lastLine()+1}return{top:G.heightAtLine(H.before||0,"local"),bot:G.heightAtLine(I,"local")}}function D(G,I,H){G.lockScroll=I;if(I&&H!=false){C(G,DIFF_INSERT)&&q(G)}G.lockButton.innerHTML=I?"\u21db\u21da":"\u21db&nbsp;&nbsp;\u21da"}function c(J,G,I){for(var H=0;H<G.length;++H){var K=G[H];if(K instanceof z.TextMarker){K.clear()}else{J.removeLineClass(K,"background",I.chunk);J.removeLineClass(K,"background",I.start);J.removeLineClass(K,"background",I.end)}}G.length=0}function u(J,L,K,I,H){var G=J.getViewport();J.operation(function(){if(K.from==K.to||G.from-K.to>20||K.from-G.to>20){c(J,K.marked,H);n(J,L,I,K.marked,G.from,G.to,H);K.from=G.from;K.to=G.to}else{if(G.from<K.from){n(J,L,I,K.marked,G.from,K.from,H);K.from=G.from}if(G.to>K.to){n(J,L,I,K.marked,K.to,G.to,H);K.to=G.to}}})}function n(N,Q,M,W,V,I,Y){var O=s(0,0);var S=s(V,0),R=N.clipPos(s(I-1));var G=M==DIFF_DELETE?Y.del:Y.insert;function P(ah,ad){var ag=Math.max(V,ah),ae=Math.min(I,ad);for(var af=ag;af<ae;++af){var ac=N.addLineClass(af,"background",Y.chunk);if(af==ah){N.addLineClass(ac,"background",Y.start)}if(af==ad-1){N.addLineClass(ac,"background",Y.end)}W.push(ac)}if(ah==ad&&ag==ad&&ae==ad){if(ag){W.push(N.addLineClass(ag-1,"background",Y.end))}else{W.push(N.addLineClass(ag,"background",Y.start))}}}var ab=0;for(var X=0;X<Q.length;++X){var U=Q[X],H=U[0],T=U[1];if(H==DIFF_EQUAL){var L=O.line+(d(Q,X)?0:1);t(O,T);var K=O.line+(h(Q,X)?1:0);if(K>L){if(X){P(ab,L)}ab=K}}else{if(H==M){var J=t(O,T,true);var aa=l(S,O),Z=j(R,J);if(!i(aa,Z)){W.push(N.markText(aa,Z,{className:G}))}O=J}}}if(ab<=O.line){P(ab,O.line+1)}}function q(J){if(!J.showDifferences){return}if(J.svg){v(J.svg);var H=J.gap.offsetWidth;x(J.svg,"width",H,"height",J.gap.offsetHeight)}v(J.copyButtons);var L=J.type=="left";var M=J.edit.getViewport(),I=J.orig.getViewport();var G=J.edit.getScrollInfo().top,K=J.orig.getScrollInfo().top;e(J.diff,function(R,T,U,Q){if(U>M.to||Q<M.from||R>I.to||T<I.from){return}var N=J.orig.heightAtLine(R,"local")-K,W=N;if(J.svg){var P=J.edit.heightAtLine(U,"local")-G;if(L){var S=N;N=P;P=S}var V=J.orig.heightAtLine(T,"local")-K;var Y=J.edit.heightAtLine(Q,"local")-G;if(L){var S=V;V=Y;Y=S}var Z=" C "+H/2+" "+P+" "+H/2+" "+N+" "+(H+2)+" "+N;var X=" C "+H/2+" "+V+" "+H/2+" "+Y+" -1 "+Y;x(J.svg.appendChild(document.createElementNS(g,"path")),"d","M -1 "+P+Z+" L "+(H+2)+" "+V+X+" z","class",J.classes.connect)}var O=J.copyButtons.appendChild(f("div",J.type=="left"?"\u21dd":"\u21dc","CodeMirror-merge-copy"));O.title="Revert chunk";O.chunk={topEdit:U,botEdit:Q,topOrig:R,botOrig:T};O.style.top=W+"px"})}function E(H,G){if(H.diffOutOfDate){return}H.edit.replaceRange(H.orig.getRange(s(G.topOrig,0),s(G.botOrig,0)),s(G.topEdit,0),s(G.botEdit,0))}var A=z.MergeView=function(L,U){if(!(this instanceof A)){return new A(L,U)}var O=U.origLeft,M=U.origRight==null?U.orig:U.origRight;var R=O!=null,V=M!=null;var P=1+(R?1:0)+(V?1:0);var I=[],K=this.left=null,S=this.right=null;if(R){K=this.left=new k(this,"left");var H=f("div",null,"CodeMirror-merge-pane");I.push(H);I.push(y(K))}var N=f("div",null,"CodeMirror-merge-pane");I.push(N);if(V){S=this.right=new k(this,"right");I.push(y(S));var Q=f("div",null,"CodeMirror-merge-pane");I.push(Q)}(V?Q:N).className+=" CodeMirror-merge-pane-rightmost";I.push(f("div",null,null,"height: 0; clear: both;"));var J=this.wrap=L.appendChild(f("div",I,"CodeMirror-merge CodeMirror-merge-"+P+"pane"));this.edit=z(N,w(U));if(K){K.init(H,O,U)}if(S){S.init(Q,M,U)}var G=function(){if(K){q(K)}if(S){q(S)}};z.on(window,"resize",G);var T=setInterval(function(){for(var W=J.parentNode;W&&W!=document.body;W=W.parentNode){}if(!W){clearInterval(T);z.off(window,"resize",G)}},5000)};function y(J){var I=J.lockButton=f("div",null,"CodeMirror-merge-scrolllock");I.title="Toggle locked scrolling";var K=f("div",[I],"CodeMirror-merge-scrolllock-wrap");z.on(I,"click",function(){D(J,!J.lockScroll)});J.copyButtons=f("div",null,"CodeMirror-merge-copybuttons-"+J.type);z.on(J.copyButtons,"click",function(M){var L=M.target||M.srcElement;if(L.chunk){E(J,L.chunk)}});var H=[J.copyButtons,K];var G=document.createElementNS&&document.createElementNS(g,"svg");if(G&&!G.createSVGRect){G=null}J.svg=G;if(G){H.push(G)}return J.gap=f("div",H,"CodeMirror-merge-gap")}A.prototype={constuctor:A,editor:function(){return this.edit},rightOriginal:function(){return this.right&&this.right.orig},leftOriginal:function(){return this.left&&this.left.orig},setShowDifferences:function(G){if(this.right){this.right.setShowDifferences(G)}if(this.left){this.left.setShowDifferences(G)}},rightChunks:function(){return this.right&&m(this.right.diff)},leftChunks:function(){return this.left&&m(this.left.diff)}};function o(G){if(typeof G=="string"){return G}else{return G.getValue()}}var a=new diff_match_patch();function b(H,G){var K=a.diff_main(H,G);a.diff_cleanupSemantic(K);for(var J=0;J<K.length;++J){var I=K[J];if(!I[1]){K.splice(J--,1)}else{if(J&&K[J-1][0]==I[0]){K.splice(J--,1);K[J][1]+=I[1]}}}return K}function e(T,L){var Q=0,P=0;var U=s(0,0),S=s(0,0);for(var I=0;I<T.length;++I){var H=T[I],R=H[0];if(R==DIFF_EQUAL){var G=d(T,I)?0:1;var K=U.line+G,J=S.line+G;t(U,H[1],null,S);var M=h(T,I)?1:0;var O=U.line+M,N=S.line+M;if(O>K){if(I){L(P,J,Q,K)}Q=O;P=N}}else{t(R==DIFF_INSERT?U:S,H[1])}}if(Q<=U.line||P<=S.line){L(P,S.line+1,Q,U.line+1)}}function m(H){var G=[];e(H,function(K,J,I,L){G.push({origFrom:K,origTo:J,editFrom:I,editTo:L})});return G}function h(I,G){if(G==I.length-1){return true}var H=I[G+1][1];if(H.length==1||H.charCodeAt(0)!=10){return false}if(G==I.length-2){return true}H=I[G+2][1];return H.length>1&&H.charCodeAt(0)==10}function d(I,G){if(G==0){return true}var H=I[G-1][1];if(H.charCodeAt(H.length-1)!=10){return false}if(G==1){return true}H=I[G-2][1];return H.charCodeAt(H.length-1)==10}function F(L,M,I){var H,G,K,J;e(L,function(N,S,Q,O){var P=I?Q:N;var R=I?O:S;if(G==null){if(P>M){G=Q;J=N}else{if(R>M){G=O;J=S}}}if(R<=M){H=O;K=S}else{if(P<=M){H=Q;K=N}}});return{edit:{before:H,after:G},orig:{before:K,after:J}}}function f(G,K,J,I){var L=document.createElement(G);if(J){L.className=J}if(I){L.style.cssText=I}if(typeof K=="string"){L.appendChild(document.createTextNode(K))}else{if(K){for(var H=0;H<K.length;++H){L.appendChild(K[H])}}}return L}function v(H){for(var G=H.childNodes.length;G>0;--G){H.removeChild(H.firstChild)}}function x(G){for(var H=1;H<arguments.length;H+=2){G.setAttribute(arguments[H],arguments[H+1])}}function w(H,G){if(!G){G={}}for(var I in H){if(H.hasOwnProperty(I)){G[I]=H[I]}}return G}function t(M,K,L,H){var J=L?s(M.line,M.ch):M,G=0;for(;;){var I=K.indexOf("\n",G);if(I==-1){break}++J.line;if(H){++H.line}G=I+1}J.ch=(G?0:J.ch)+(K.length-G);if(H){H.ch=(G?0:H.ch)+(K.length-G)}return J}function j(H,G){return(H.line-G.line||H.ch-G.ch)<0?H:G}function l(H,G){return(H.line-G.line||H.ch-G.ch)>0?H:G}function i(H,G){return H.line==G.line&&H.ch==G.ch}});