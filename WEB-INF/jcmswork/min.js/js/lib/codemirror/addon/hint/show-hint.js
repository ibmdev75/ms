(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(c){var f="CodeMirror-hint";var b="CodeMirror-hint-active";c.showHint=function(i,k,l){if(i.listSelections().length>1||i.somethingSelected()){return}if(k==null){if(l&&l.async){return}else{k=c.hint.auto}}if(i.state.completionActive){i.state.completionActive.close()}var j=i.state.completionActive=new h(i,k,l||{});c.signal(i,"startCompletion",i);if(j.options.async){k(i,function(m){j.showHints(m)},j.options)}else{return j.showHints(k(i,j.options))}};function h(i,j,k){this.cm=i;this.getHints=j;this.options=k;this.widget=this.onClose=null}h.prototype={close:function(){if(!this.active()){return}this.cm.state.completionActive=null;if(this.widget){this.widget.close()}if(this.onClose){this.onClose()}c.signal(this.cm,"endCompletion",this.cm)},active:function(){return this.cm.state.completionActive==this},pick:function(l,k){var j=l.list[k];if(j.hint){j.hint(this.cm,l,j)}else{this.cm.replaceRange(a(j),j.from||l.from,j.to||l.to)}c.signal(l,"pick",j);this.close()},showHints:function(i){if(!i||!i.list.length||!this.active()){return this.close()}if(this.options.completeSingle!=false&&i.list.length==1){this.pick(i,0)}else{this.showWidget(i)}},showWidget:function(n){this.widget=new e(this,n);c.signal(n,"shown");var u=0,k=this,j;var v=this.options.closeCharacters||/[\s()\[\]{};:>,]/;var r=this.cm.getCursor(),o=this.cm.getLine(r.line).length;var s=window.requestAnimationFrame||function(w){return setTimeout(w,1000/60)};var p=window.cancelAnimationFrame||clearTimeout;function m(){if(j){return}j=true;k.close();k.cm.off("cursorActivity",i);if(n){c.signal(n,"close")}}function l(){if(j){return}c.signal(n,"update");if(k.options.async){k.getHints(k.cm,t,k.options)}else{t(k.getHints(k.cm,k.options))}}function t(w){n=w;if(j){return}if(!n||!n.list.length){return m()}k.widget=new e(k,n)}function q(){if(u){p(u);u=0}}function i(){q();var x=k.cm.getCursor(),w=k.cm.getLine(x.line);if(x.line!=r.line||w.length-x.ch!=o-r.ch||x.ch<r.ch||k.cm.somethingSelected()||(x.ch&&v.test(w.charAt(x.ch-1)))){k.close()}else{u=s(l);if(k.widget){k.widget.close()}}}this.cm.on("cursorActivity",i);this.onClose=m}};function a(i){if(typeof i=="string"){return i}else{return i.text}}function d(l,n){var i={Up:function(){n.moveFocus(-1)},Down:function(){n.moveFocus(1)},PageUp:function(){n.moveFocus(-n.menuSize()+1,true)},PageDown:function(){n.moveFocus(n.menuSize()-1,true)},Home:function(){n.setFocus(0)},End:function(){n.setFocus(n.length-1)},Enter:n.pick,Tab:n.pick,Esc:n.close};var k=l.customKeys?{}:i;function j(o,q){var p;if(typeof q!="string"){p=function(r){return q(r,n)}}else{if(i.hasOwnProperty(q)){p=i[q]}else{p=q}}k[o]=p}if(l.customKeys){for(var m in l.customKeys){if(l.customKeys.hasOwnProperty(m)){j(m,l.customKeys[m])}}}if(l.extraKeys){for(var m in l.extraKeys){if(l.extraKeys.hasOwnProperty(m)){j(m,l.extraKeys[m])}}}return k}function g(j,i){while(i&&i!=j){if(i.nodeName.toUpperCase()==="LI"&&i.parentNode==j){return i}i=i.parentNode}}function e(x,H){this.completion=x;this.data=H;var o=this,t=x.cm,n=x.options;var E=this.hints=document.createElement("ul");E.className="CodeMirror-hints";this.selectedHint=n.getDefaultSelection?n.getDefaultSelection(t,n,H):0;var s=H.list;for(var G=0;G<s.length;++G){var m=E.appendChild(document.createElement("li")),l=s[G];var k=f+(G!=this.selectedHint?"":" "+b);if(l.className!=null){k=l.className+" "+k}m.className=k;if(l.render){l.render(m,H,l)}else{m.appendChild(document.createTextNode(l.displayText||a(l)))}m.hintId=G}var r=t.cursorCoords(n.alignWithWord!==false?H.from:null);var p=r.left,B=r.bottom,z=true;E.style.left=p+"px";E.style.top=B+"px";var u=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth);var F=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(n.container||document.body).appendChild(E);var v=E.getBoundingClientRect(),w=v.bottom-F;if(w>0){var C=v.bottom-v.top,j=v.top-(r.bottom-r.top);if(j-C>0){E.style.top=(B=j-C)+"px";z=false}else{if(C>F){E.style.height=(F-5)+"px";E.style.top=(B=r.bottom-v.top)+"px";var q=t.getCursor();if(H.from.ch!=q.ch){r=t.cursorCoords(q);E.style.left=(p=r.left)+"px";v=E.getBoundingClientRect()}}}}var y=v.left-u;if(y>0){if(v.right-v.left>u){E.style.width=(u-5)+"px";y-=(v.right-v.left)-u}E.style.left=(p=r.left-y)+"px"}t.addKeyMap(this.keyMap=d(n,{moveFocus:function(I,i){o.changeActive(o.selectedHint+I,i)},setFocus:function(i){o.changeActive(i)},menuSize:function(){return o.screenAmount()},length:s.length,close:function(){x.close()},pick:function(){o.pick()},data:H}));if(n.closeOnUnfocus!==false){var D;t.on("blur",this.onBlur=function(){D=setTimeout(function(){x.close()},100)});t.on("focus",this.onFocus=function(){clearTimeout(D)})}var A=t.getScrollInfo();t.on("scroll",this.onScroll=function(){var K=t.getScrollInfo(),J=t.getWrapperElement().getBoundingClientRect();var I=B+A.top-K.top;var i=I-(window.pageYOffset||(document.documentElement||document.body).scrollTop);if(!z){i+=E.offsetHeight}if(i<=J.top||i>=J.bottom){return x.close()}E.style.top=I+"px";E.style.left=(p+A.left-K.left)+"px"});c.on(E,"dblclick",function(I){var i=g(E,I.target||I.srcElement);if(i&&i.hintId!=null){o.changeActive(i.hintId);o.pick()}});c.on(E,"click",function(I){var i=g(E,I.target||I.srcElement);if(i&&i.hintId!=null){o.changeActive(i.hintId);if(n.completeOnSingleClick){o.pick()}}});c.on(E,"mousedown",function(){setTimeout(function(){t.focus()},20)});c.signal(H,"select",s[0],E.firstChild);return true}e.prototype={close:function(){if(this.completion.widget!=this){return}this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var i=this.completion.cm;if(this.completion.options.closeOnUnfocus!==false){i.off("blur",this.onBlur);i.off("focus",this.onFocus)}i.off("scroll",this.onScroll)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(j,l){if(j>=this.data.list.length){j=l?this.data.list.length-1:0}else{if(j<0){j=l?0:this.data.list.length-1}}if(this.selectedHint==j){return}var k=this.hints.childNodes[this.selectedHint];k.className=k.className.replace(" "+b,"");k=this.hints.childNodes[this.selectedHint=j];k.className+=" "+b;if(k.offsetTop<this.hints.scrollTop){this.hints.scrollTop=k.offsetTop-3}else{if(k.offsetTop+k.offsetHeight>this.hints.scrollTop+this.hints.clientHeight){this.hints.scrollTop=k.offsetTop+k.offsetHeight-this.hints.clientHeight+3}}c.signal(this.data,"select",this.data.list[this.selectedHint],k)},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}};c.registerHelper("hint","auto",function(j,k){var m=j.getHelpers(j.getCursor(),"hint"),o;if(m.length){for(var l=0;l<m.length;l++){var n=m[l](j,k);if(n&&n.list.length){return n}}}else{if(o=j.getHelper(j.getCursor(),"hintWords")){if(o){return c.hint.fromList(j,{words:o})}}else{if(c.hint.anyword){return c.hint.anyword(j,k)}}}});c.registerHelper("hint","fromList",function(j,k){var p=j.getCursor(),m=j.getTokenAt(p);var n=[];for(var l=0;l<k.words.length;l++){var o=k.words[l];if(o.slice(0,m.string.length)==m.string){n.push(o)}}if(n.length){return{list:n,from:c.Pos(p.line,m.start),to:c.Pos(p.line,m.end)}}});c.commands.autocomplete=c.showHint});