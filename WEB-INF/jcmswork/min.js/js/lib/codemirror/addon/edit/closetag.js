(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../fold/xml-fold"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../fold/xml-fold"],a)}else{a(CodeMirror)}}})(function(b){b.defineOption("autoCloseTags",false,function(g,j,h){if(h!=b.Init&&h){g.removeKeyMap("autoCloseTags")}if(!j){return}var i={name:"autoCloseTags"};if(typeof j!="object"||j.whenClosing){i["'/'"]=function(k){return e(k)}}if(typeof j!="object"||j.whenOpening){i["'>'"]=function(k){return a(k)}}g.addKeyMap(i)});var d=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"];var c=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"];function a(v){if(v.getOption("disableInput")){return b.Pass}var h=v.listSelections(),p=[];for(var q=0;q<h.length;q++){if(!h[q].empty()){return b.Pass}var u=h[q].head,w=v.getTokenAt(u);var x=b.innerMode(v.getMode(),w.state),g=x.state;if(x.mode.name!="xml"||!g.tagName){return b.Pass}var j=v.getOption("autoCloseTags"),r=x.mode.configuration=="html";var l=(typeof j=="object"&&j.dontCloseTags)||(r&&d);var t=(typeof j=="object"&&j.indentTags)||(r&&c);var o=g.tagName;if(w.end>u.ch){o=o.slice(0,o.length-w.end+u.ch)}var s=o.toLowerCase();if(!o||w.type=="string"&&(w.end!=u.ch||!/[\"\']/.test(w.string.charAt(w.string.length-1))||w.string.length==1)||w.type=="tag"&&g.type=="closeTag"||w.string.indexOf("/")==(w.string.length-1)||l&&f(l,s)>-1||b.scanForClosingTag&&b.scanForClosingTag(v,u,o,Math.min(v.lastLine()+1,u.line+50))){return b.Pass}var n=t&&f(t,s)>-1;p[q]={indent:n,text:">"+(n?"\n\n":"")+"</"+o+">",newPos:n?b.Pos(u.line+1,0):b.Pos(u.line,u.ch+1)}}for(var q=h.length-1;q>=0;q--){var m=p[q];v.replaceRange(m.text,h[q].head,h[q].anchor,"+insert");var k=v.listSelections().slice(0);k[q]={head:m.newPos,anchor:m.newPos};v.setSelections(k);if(m.indent){v.indentLine(m.newPos.line,null,true);v.indentLine(m.newPos.line+1,null,true)}}}function e(g){if(g.getOption("disableInput")){return b.Pass}var h=g.listSelections(),m=[];for(var l=0;l<h.length;l++){if(!h[l].empty()){return b.Pass}var o=h[l].head,k=g.getTokenAt(o);var j=b.innerMode(g.getMode(),k.state),n=j.state;if(k.type=="string"||k.string.charAt(0)!="<"||k.start!=o.ch-1||j.mode.name!="xml"||!n.context||!n.context.tagName){return b.Pass}m[l]="/"+n.context.tagName+">"}g.replaceSelections(m)}function f(k,g){if(k.indexOf){return k.indexOf(g)}for(var h=0,j=k.length;h<j;++h){if(k[h]==g){return h}}return -1}});