(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(a){function b(l,k,m,g){var e=m&&(m.call?m:m.rangeFinder);if(!e){e=a.fold.auto}if(typeof k=="number"){k=a.Pos(k,0)}var f=m&&m.minFoldSize||0;function d(n){var o=e(l,k);if(!o||o.to.line-o.from.line<f){return null}var q=l.findMarksAt(o.from);for(var p=0;p<q.length;++p){if(q[p].__isFold&&g!=="fold"){if(!n){return null}o.cleared=true;q[p].clear()}}return o}var i=d(true);if(m&&m.scanUp){while(!i&&k.line>l.firstLine()){k=a.Pos(k.line-1,0);i=d(false)}}if(!i||i.cleared||g==="unfold"){return}var j=c(m);a.on(j,"mousedown",function(){h.clear()});var h=l.markText(i.from,i.to,{replacedWith:j,clearOnEnter:true,__isFold:true});h.on("clear",function(o,n){a.signal(l,"unfold",l,o,n)});a.signal(l,"fold",l,i.from,i.to)}function c(d){var e=(d&&d.widget)||"\u2194";if(typeof e=="string"){var f=document.createTextNode(e);e=document.createElement("span");e.appendChild(f);e.className="CodeMirror-foldmarker"}return e}a.newFoldFunction=function(e,d){return function(f,g){b(f,g,{rangeFinder:e,widget:d})}};a.defineExtension("foldCode",function(f,d,e){b(this,f,d,e)});a.defineExtension("isFolded",function(f){var e=this.findMarksAt(f);for(var d=0;d<e.length;++d){if(e[d].__isFold){return true}}});a.commands.toggleFold=function(d){d.foldCode(d.getCursor())};a.commands.fold=function(d){d.foldCode(d.getCursor(),null,"fold")};a.commands.unfold=function(d){d.foldCode(d.getCursor(),null,"unfold")};a.commands.foldAll=function(d){d.operation(function(){for(var f=d.firstLine(),g=d.lastLine();f<=g;f++){d.foldCode(a.Pos(f,0),null,"fold")}})};a.commands.unfoldAll=function(d){d.operation(function(){for(var f=d.firstLine(),g=d.lastLine();f<=g;f++){d.foldCode(a.Pos(f,0),null,"unfold")}})};a.registerHelper("fold","combine",function(){var d=Array.prototype.slice.call(arguments,0);return function(e,h){for(var f=0;f<d.length;++f){var g=d[f](e,h);if(g){return g}}}});a.registerHelper("fold","auto",function(d,h){var f=d.getHelpers(h,"fold");for(var e=0;e<f.length;e++){var g=f[e](d,h);if(g){return g}}})});