!function(f){var k="html5,flash,silverlight,html4";var l=f.jalios.Http.getContextPath()+"/js/lib/plupload-2.1.2/js/Moxie.swf";var c=f.jalios.Http.getContextPath()+"/js/lib/plupload-2.1.2/js/Moxie.xap";var g=f.jalios.Http.getContextPath()+"/jcore/plupload.jsp";var b=f.jalios.Properties.get("plupload-filters");for(filterName in b){var a=b[filterName];a.title=f.jalios.I18N.glp("plupload-filters."+filterName)+" ("+a.extensions+")"}var i=false;var j=function(){if(i){return}i=true;f(document).on("jalios:refresh",function(o){var n=f.jalios.Event.match(o,"refresh","after");if(!n){return}d()});d()};var d=function(){f("DIV.plupload").each(function(){var t=f(this);var q=t.attr("class");if(t.data("plupload")){return}if(t.parent().closest("DIV.plupload").exists()){return}var p={url:g,runtimes:k,max_file_size:"2000mb",multipart:true,multipart_params:{},headers:{"X-Jcms-Plupload":"true"},init:function(u){t.data("plupload",u);u.bind("FileUploaded",f.proxy(e,t[0]));u.bind("FilesAdded",f.proxy(h,t[0]))},flash_swf_url:l,silverlight_xap_url:c};for(filterName in b){if(t.hasClass("plupload-filter-"+filterName)){p.filters=[b[filterName]]}}if(t.hasClass("plupload-single")){p.multi_selection=false;p.max_file_count=1}var o=q.match(/plupload-resize-(\d+)x(\d+)x(\d+)/);if(o&&o.length>1){p.resize={width:o[1],height:o[2],quality:o[3]}}var s=q.match(/plupload-field-(\w+)/);if(s){p.multipart_params.field=s[1]}var n=document.body.id;var r=q.match(/plupload-token-(\w+)/);p.multipart_params.token=r||n;t.closest("FORM").append('<input name="plupload-token" type="hidden" value="'+(r||n)+'"/>');t.closest("FORM").find(".plupload-submit").on("click",m);t.pluploadQueue(p)})};var e=function(n,p,o){f(this).append('<input name="'+n.settings.multipart_params.field+'" type="hidden" value="MultipartUpload"/>')};var h=function(o,p){var n=o.settings.max_file_count;if(o.files.length<=n){return}while(o.files.length>n){if(o.files.length>n){o.removeFile(o.files[n])}}};var m=function(p){var o=p.currentTarget;var q=f(o).closest("FORM").find("DIV.plupload");var n=q.data("plupload");if(!n){return}if(!q.data("p-init")){q.data("p-init",true);n.bind("UploadComplete",function(r,s){if(r.total.queued==0){f.jalios.DOM.follow(o)}})}if(n.total.queued!=0){n.start();p.preventDefault();p.stopPropagation();return false}};f(document).on("jalios:ready",j)}(window.jQuery);