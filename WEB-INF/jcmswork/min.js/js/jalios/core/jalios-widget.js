!function(f){if(!f.jalios){f.jalios={}}if(!f.jalios.ui){f.jalios.ui={}}var l=function(){f(document).on("focusin","DIV.widget INPUT",function(o){var n=f(o.currentTarget);n.getWidget().addClass("focus-widget")});f(document).on("focusout","DIV.widget INPUT",function(o){var n=f(o.currentTarget);n.getWidget().removeClass("focus-widget")});f(document).on("input propertychange","DIV.widget INPUT.form-control-autocomplete",function(n){var o=f(this);if(!o.val()){o.next(".form-control").val("")}});f(document).on("keydown","DIV.widget.keyword INPUT",function(n){f.jalios.ui.Widget.Keyword.resizeKeyword(f(this))});f(document).on("click","DIV.widget .add-field",e);f(document).on("change","DIV.widget.keyword INPUT",function(n){f.jalios.ui.Widget.Keyword.resizeKeyword(f(this));f.jalios.ui.Widget.Keyword.toggleClear.defer(f(this))});f(document).on("jalios:refresh",function(o){var n=f.jalios.Event.match(o,"refresh","after");if(!n){return}if(n.target){d(n.target,!n.options.noscroll)}});f(document).on("jalios:refresh",function(p){var o=f.jalios.Event.match(p,"refresh","before");if(!o||!o.options){return}var n=f(o.options.trigger);if(n.getJcmsId()!="CtxWidget"){return}j(n,o.options.params)})};var d=function(p,n){if(!p){return}var o=f(p);if(o.closest(".no-focus").exists()){return}var q=o.find(".focus");if(q.exists()){o=q}var r=o.find(":input:visible:first");if(r.closest(".no-focus").exists()){return}if(!r.exists()){return}if(n){r.focus();f("html,body").animate({scrollTop:r.offset().top-f(window).height()/2},"fast")}else{r.focusWithoutScrolling()}};var g=function(q,p){var o=f(q||f.jalios.ui.CtxMenu.$latest);var s=f.jalios.ui.Widget.getWrapper(o);h(s);var r=f.jalios.ui.Widget.Keyword.isInKeyword(o);var n=f.jalios.ui.Widget.getWidget(o).hasClass("multivalued");if(!p&&(r||n)){JCMS.form.Widget.remove(o[0]);return false}};var h=function(n){n.find("INPUT, SELECT, TEXTAREA").each(function(){var o=f(this);if(o.prop("checked")){o.prop("checked",false)}else{if(o.prop("selectedIndex")){o.prop("selectedIndex",0)}else{o.val("").change()}}})};var e=function(q){q.preventDefault();var o=f(q.currentTarget);var t=f.jalios.ui.Widget.getWidget(o);var p=t.find(".jalios-nav-pills");var n=p.children().last();var r=n.children();var s=r.data("jalios-fieldgroup");if(s){f("A[data-jalios-fieldgroup="+s+"]").each(function(){var w=f(this);var v=w.closest(".tab-pane.wdglang");var u=v.exists()?v:f.jalios.ui.Widget.getWidget(w);k(u)})}else{k(t)}};var k=function(n){f.jalios.Wiki.hideWikiToolbar(n);var o=n.find(".tab-pane.wdglang");if(o.exists()){o.each(function(){b(f(this))})}else{b(n)}};var b=function(w){var u=w.find("OL.input-group-list, UL.input-group-list");var r=u.children().last().clone();r.removeClass("active");u.append(r);r.find(".form-control").each(function(){var z=f(this);m(z);if(z.hasClass("tinyMceInitialized")){z.removeClass("tinyMceInitialized");z.show();z.next("SPAN.mceEditor").remove();var y=f.Event("jalios:tinymce");y.tinymce={};y.tinymce.type="refresh";f(document).trigger(y)}});var t=r.find(".jalios-publication-filebrowser");if(t.exists()){m(t);if(t.is(":input")){t.prop("disabled",false)}else{t.empty();t.jcmsPlupload()}t.removeClass("hide");r.find("INPUT.form-control-display").addClass("hide").prop("disabled",true);r.find("INPUT.form-control-value").addClass("hide").prop("disabled",true)}h(r);var x=w.find(".jalios-nav-pills");var q=x.children().last().clone();q.removeClass("active");x.append(q);var n=m(r);if(!n){return}var s=q.children();var v=parseInt(n.substring(n.lastIndexOf("_")+1));s.attr("href","#"+n).html(v);var p=s.data("jalios-fieldgroup");if(p){var o=p.substring(0,p.lastIndexOf("_")+1)+v;s.data("jalios-fieldgroup",o);s.attr("data-jalios-fieldgroup",o)}};var m=function(o){var p=f(o);var s=p.attr("id");if(s){var q=s.substring(0,s.lastIndexOf("_")+1);var r=parseInt(s.substring(s.lastIndexOf("_")+1))+1;var n=q+r;p.attr("id",n);return n}return false};var c={UI_EDITOR_COLORCHOOSER:"F",UI_EDITOR_IMAGEPATH:"I",UI_EDITOR_SIMPLEIMAGEPATH:"I",UI_EDITOR_MEDIAPATH:"M",UI_EDITOR_SIMPLEMEDIAPATH:"M",UI_EDITOR_DATECHOOSER:"V",UI_EDITOR_MEMBERCHOOSER:"EHJY",UI_EDITOR_GROUPCHOOSER:"EGY",UI_EDITOR_PUBLICATIONCHOOSER:"ELXMSCcY",UI_EDITOR_PUBLICATIONSCHOOSER:"ELXMSCcY",UI_EDITOR_CATEGORYCHOOSER:"EZY",UI_EDITOR_CATEGORIESCHOOSER:"EZY",UI_EDITOR_WORKSPACECHOOSER:"EOY",UI_EDITOR_QUERYCHOOSER:"QY",UI_EDITOR_ACLCHOOSER:"Y",UI_EDITOR_SQLQUERY:"",UI_EDITOR_DBRECORDCHOOSER:""};var j=function(n,p){var t=n.getWidget();var s=f.jalios.ui.Widget.getWrapper(n);p.items="";var r=t.attr("class").split(/\s+/);for(var q=0;q<r.length;q++){if(!c[r[q]]){continue}p.items+=c[r[q]]}if(s.is("LI")){p.items=(s.parent().is("OL")&&!t.hasClass("nodnd"))?("R"+p.items+"-ATUD-"):(p.items+"-AT-")}else{p.items="R"+p.items}if(t.is("ml")){p.items+="y"}p.lang=f.jalios.ui.Widget.getLanguage(n);var o=s.find("INPUT.formChooserfield");if(!o.exists()){return}p.chooserId=o.val();p.chooserType=t.matchClass(/super_([\w\.]+)/,1)||false};f.jalios.ui.Widget={getWidget:function(o){if(!o){return}var n=f(o);return n.closest("DIV.widget, SPAN.widget")},getWrapper:function(p){if(!p){return}var n=f(p);var o=n.closest("LI, DIV");return o.is(".input-group-btn")?o.parent():o},getLanguage:function(o){if(!o){return}var n=f(o);return n.closest("DIV.wdglang").matchClass(/wdglang-(\S+)/,1)||false},smartFocus:d,clear:g};f.jalios.ui.Widget.Keyword={isInKeyword:function(n){return f.jalios.ui.Widget.getWidget(n).hasClass("keyword")},resizeKeyword:function(n){if(!f.jalios.ui.Widget.Keyword.isInKeyword(n)){return}var o=f(n);o.attr("size",o.val().length||1)},toggleClear:function(n){if(!f.jalios.ui.Widget.Keyword.isInKeyword(n)){return}var o=f(n)}};f.fn.getWidget=function(){return f.jalios.ui.Widget.getWidget(this)};f.fn.smartFocus=function(){return f.jalios.ui.Widget.smartFocus(this)};f.fn.focusWithoutScrolling=function(){if(!this.exists()){return}var n=window.scrollX,p=window.scrollY,o=f(window);this.parents("DIV").each(function(){if(f(this).css("overflow")!="auto"){return}o=f(this);p=o.scrollTop();n=o.scrollLeft();return false});this.focus();o.scrollTop(p);o.scrollLeft(n)};f.fn.toggleDisabledField=function(){f(this).toggleClass("disabled");f(this).find(":input").prop("disabled",function(n,o){return !o});f(this).find("A.ctxLangForm").toggleClass("disabled")};var i=f.fn.addClass;f.fn.addClass=function(n){var o=i.apply(this,arguments);if(this.exists()&&(n=="active"||n=="in")){d(this)}return o};var a=f.fn.removeClass;f.fn.removeClass=function(n){var o=a.apply(this,arguments);if(this.exists()&&(n=="hide"||n=="hide-scroll")){d(this,n=="hide-scroll")}return o};f(document).ready(function(n){l()})}(window.jQuery);