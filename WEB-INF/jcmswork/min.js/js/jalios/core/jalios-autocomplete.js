!function(f){var a=false;var b=Typeahead.prototype.lookup;Typeahead.prototype.lookup=function(p){if(!this.options.ajax){return f.proxy(b,this)()}if(this.$element.prop("tagName")=="TEXTAREA"){var r={type:"lookup",typeahead:this,explicit:p};Typeahead.hooks.fire(r);if(r.stop){return this}}else{this.query=this.$element.val()||"";var s=this.$element.attr("data-ac-lookup-empty")||false;if(this.query===""&&!s){return this.shown?this.hide():this}var o=this.$element.attr("data-ac-min-length")||2;if(!s&&(this.query.length<o)){return this.hide()}}var q=this;if(a){clearTimeout(a)}a=setTimeout(function(){j(q);a=false},250);return this.hide()};var j=function(o){o.$menu.refresh({url:o.options.ajax,params:{autocomplete:o.query},noscroll:true,nohistory:true,waiting:false,noerror:true,callback:function(){o.show()}})};var n=Typeahead.prototype.click;Typeahead.prototype.click=function(o){o.stopPropagation();o.preventDefault();this.select(undefined,o)};var i=Typeahead.prototype.select;Typeahead.prototype.select=function(s,w){if(a){clearTimeout(a)}var q=this.$element;var y=s||this.$menu.find(".active");var x=y.attr("data-value");if(w){var r=f(w.target);var z=r.hasClass("typeahead-ajax-refresh")?r:r.closest(".typeahead-ajax-refresh");if(z.exists()){var A={params:z.data("jalios-typeahead-options-params")};this.$menu.refresh(A);return}}if(y.hasClass("typeahead-layout")){return}if(y.is(".nomatch")){return this.hide()}var v=this;if(y.hasClass("ajax-refresh")){q.focus();y.find("A").refresh({noscroll:true,nohistory:true,callback:f.proxy(function(){var B=v.$menu.find("LI.select").first();if(B.exists()){v.select(B)}},v)});return this.show()}var p={type:"select",typeahead:this,$active:y};Typeahead.hooks.fire(p);if(!p.stop){if(x){f.proxy(i,this)()}else{if(y.exists()){var u=w?f(w.target).closest("A.typeahead-link"):undefined;var o;if(u&&u.exists()){o=u.prop("href")}else{o=y.find("A").prop("href")}if(!o){return}if(o.indexOf("http")!=0){o=f(document).find("base").prop("href")+o}if(w&&w.which===2){var t=window.open(o,"_blank")}else{f.jalios.Browser.redirect(o,false,false)}}else{if(q[0]&&q[0].form){q[0].form.submit()}}}}var p=f.Event("jalios:autocomplete");p.autocomplete=this;f(document).trigger(p);return this.hide()};var e=Typeahead.prototype.keydown;Typeahead.prototype.keydown=function(o){if(o.keyCode!=9){this.$element.data("autocomplete-update",true)}if(o.keyCode==32&&o.ctrlKey){this.lookup(true);o.preventDefault();o.stopPropagation();return}f.proxy(e,this)(o)};var k=Typeahead.prototype.show;Typeahead.prototype.show=function(r){f.proxy(k,this)(r);if(!this.$element.is(":visible")){return this.hide()}if(this.$element.prop("tagName")!="TEXTAREA"){var q=this.$menu;var s=q.offset().left;var o=f(window).width()+f(window).scrollLeft();if(s+q.width()>o){q.find("UL").css("width",(o-s-20)+"px")}return this}var p={type:"show",typeahead:this};Typeahead.hooks.fire(p);return this};Typeahead.prototype.blur=function(o){};Typeahead.prototype.clear=function(o){};var g=Typeahead.prototype.next;Typeahead.prototype.next=function(o){f.proxy(g,this)(o);if(!this.$menu.find(".active").is(".typeahead-layout")){return}f.proxy(g,this)(o)};var d=Typeahead.prototype.prev;Typeahead.prototype.prev=function(o){f.proxy(d,this)(o);if(!this.$menu.find(".active").is(".typeahead-layout")){return}f.proxy(d,this)(o)};Typeahead.hooks=f.Callbacks();var l=function(){f(document).on("focusin",".typeahead[data-jalios-ajax-refresh-url]",m);f(document).on("jalios:refresh",h);f(document).on("click",c)};var c=function(p){var o=f(p.target);if(o.exists&&(o.hasClass("typeahead-menu")||o.hasClass("typeahead-input")||o.hasClass("typeahead-label")||o.parent().hasClass("typeahead-container"))){return}f(".typeahead-menu").hide()};var h=function(p){var o=f.jalios.Event.match(p,"refresh","success");if(!o){return}if(o.target&&o.target.hasClass("typeahead-menu")){return}f(".typeahead-menu").hide()};var m=function(r){var p=f(r.currentTarget);if(p.data("typeahead")){return}var q=f(p.data("ac-typeahead-menu"));if(!q.exists()){q=f('<div class="typeahead-menu ajax-refresh-div"></div>')}var o=p.attr("data-jalios-ajax-refresh-url");if(o){p.attr("autocomplete","off");p.typeahead({menu:q,ajax:o})}};f(document).ready(function(o){l()})}(window.jQuery);