!function(e){var d=/modal/i;var g=function(i){if(i&&i.skip=="modal"){return}var h=e.jalios.Event.match(i,"broker",d,true,true);if(!h){return}var j=h.source.currentTarget;e.jalios.ui.Modal.open(j,h.options)};var f=function(h){if(h.skip=="modal"){return}h.preventDefault();h.stopPropagation();h.stopImmediatePropagation();e.jalios.ui.Modal.open(h.currentTarget);e.jalios.ui.CtxMenu.hide()};var a=0;var c=function(i){var h=e("#jalios-previous-modal-"+a);if(h.exists()){h.prop("id","jalios-modal");h.modal("show");a--}};var b=function(){e(document).on("jalios:broker",g);e(document).on("click","A.modal",f);e(document).on("click",":button.modal",f);e(document).on("click",":submit.modal",f);e(document).on("hide.bs.modal",c);e(document).on("keydown",function(k){if(k.which!=13){return}var l=e(document.body);if(!l.hasClass("modal-open")){return}var h=e(k.target);if(h.prop("tagName")=="TEXTAREA"){return}if(h.is(":input")){var j=l.find(".modal-content .modal-footer .btn-primary").last();if(!j.exists()){return}var i=e.Event("click");i.which=1;j.trigger(i)}k.preventDefault()})};if(!e.jalios){e.jalios={}}if(!e.jalios.ui){e.jalios.ui={}}e.jalios.ui.Modal={latest:{},openFromUrl:function(j,i){var h=e.jalios.ui.Modal.getModal();if(!h||!h.exists()){return}e.jalios.ui.Modal.latest=i||{};h.modal("show");var k=e.extend(true,{},{url:j,noscroll:true,nohistory:true},i);k.callback=false;h.refresh(k);e.jalios.ui.CtxMenu.hide()},open:function(o,t){if(!o){return false}var p=e(o);if(p.is(".disabled")||p.closest("LI").is(".disabled")){return false}var j=p.closest("DIV.modal");if(j.exists()){a++;e.jalios.ui.Modal.close(false);e("#jalios-modal").prop("id","jalios-previous-modal-"+a)}e.jalios.ui.Modal.latest=t||{};e.jalios.ui.Modal.latest.trigger=p;var r=e.jalios.ui.Modal.getModal();if(!r||!r.exists()){return}var k=false;var n=false;if(p.hasClass("alert")){k="jcore/modal/alert.jsp";n=true}else{if(p.hasClass("confirm")){k="jcore/modal/confirm.jsp";n=true}else{if(p.hasClass("prompt")){k="jcore/modal/prompt.jsp";n=true}else{if(p.hasClass("warning")){k="jcore/modal/warning.jsp";n=true}else{if(p.hasClass("permalink")){k="jcore/modal/permalink.jsp";n=true}}}}}if(n){k+="?";var m=p.attr("data-jalios-text")||p.attr("title");k+=m?"msg="+e.jalios.Http.encode(m)+"&":"";r.addClass("modal-msg");var l=p.attr("data-jalios-modal-default");if(!l&&p.hasClass("permalink")){l=p[0].href}k+=l?"&defValue="+e.jalios.Http.encode(l)+"&":""}var i=p.get(0).href;if(i&&i.match(new RegExp("(jpg|jpeg|gif|png|bmp)([?][^?]+)*$","img"))){k="jcore/modal/image.jsp?url="+e.jalios.Http.encode(i)}var i=p.attr("data-jalios-modal-url");if(i){k=i}if(t&&t.url){k=t.url}var s=p.attr("rel");if(s){var q=e.jalios.Http.encode(p.attr("title"));k="jcore/modal/"+s.toLowerCase()+".jsp?url="+e.jalios.Http.encode(i)}r.modal("show");var h=e.extend(true,{},{target:"#jalios-modal",url:k,noscroll:true,nohistory:true,waiting:p.hasClass("modal-waiting")},t);h.callback=false;p.refresh(h);e.jalios.ui.CtxMenu.hide()},prompt:function(j,k,h){var i="jcore/modal/prompt.jsp?msg="+e.jalios.Http.encode(j);if(h){i+="&defValue="+h}e.jalios.ui.Modal.openFromUrl(i,{callback:k,value:h});return false},confirm:function(j,k,i){var h="jcore/modal/confirm.jsp?msg="+e.jalios.Http.encode(j);e.jalios.ui.Modal.openFromUrl(h,{callback:function(l){if(l&&!i){k(l)}if(!l&&i){k(l)}}});return false},alert:function(j,k){var h="jcore/modal/alert.jsp?msg="+e.jalios.Http.encode(j);var i={};if(k){i.callback=function(l){k(l)}}e.jalios.ui.Modal.openFromUrl(h,i);return false},confirmInModal:function(k,n){var i=e(k);var j=i.closest("DIV.modal .modal-content .modal-footer");var m=i.attr("data-jalios-text")||i.attr("title")||I18N.glp("msg.js.confirm");var l='<div class="modal-confirm modal-confirm-inline fade"><span class="pull-left">'+m+'</span><div class="confirm-buttons pull-right"><a href="#" class="btn btn-default btn-cancel">'+I18N.glp("com.lbl.cancel")+'</a>&nbsp;<a href="#" class="btn btn-danger btn-confirm">'+I18N.glp("com.lbl.ok")+"</a></div></div>";var h=e(l);h.appendTo(j).delay(300).queue(function(o){e(this).addClass("in");o()});e(document).on("click",".modal-confirm .btn-cancel, .modal-confirm .btn-danger",function(q){q.preventDefault();var o=e(q.target);var r=o.closest(".modal-confirm");var p=e(this);if(o.hasClass("btn-confirm")){e(".modal-footer").remove();e(".modal-body").addClass("text-center").html(e("<img/>").attr("src","images/jalios/icons/wait.gif"))}r.removeClass("in").delay(500).queue(function(s){n(p.hasClass("btn-danger"));r.remove();s()})})},close:function(h){e.jalios.ui.Modal.latest.value=h;e("#jalios-modal").modal("hide");return false},closeAndReload:function(h){e.jalios.ui.Modal.close();if(h){e.jalios.Browser.redirect(h)}else{e.jalios.Browser.reload()}return false},closeAndRefresh:function(){e.jalios.ui.Modal.close();e.jalios.AjaxRefresh.refreshTarget(e.jalios.ui.Modal.latest.trigger);return false},closeAndFollow:function(h){e.jalios.ui.Modal.close(h);if(e.jalios.ui.Modal.latest.callback){return false}e.jalios.DOM.follow(e.jalios.ui.Modal.latest.trigger,"modal","value",h);return false},getModal:function(){var h=e("#jalios-modal");if(h.exists()){if(h.data("bs.modal").isShown){e.console.warn("[Modal]","Cannot open a Modal when a modal is already opened");return}h.children().hide().remove("A.ajax-refresh-url");h.prop("class","modal fade ajax-refresh-div").css("width","").css("marginLeft","").removeAttr("data-jalios-ajax-refresh-url");return h}h=e('<div id="jalios-modal" class="modal fade ajax-refresh-div" role="dialog" aria-labelledby="modalLabel" aria-hidden="true"></div>').appendTo("BODY");h.modal({keyboard:true,backdrop:"static"});h.on("hidden.bs.modal",function(i){if(e.jalios.ui.Modal.latest.callback){e.jalios.ui.Modal.latest.callback(e.jalios.ui.Modal.latest.value)}});h.on("click",".modal-steps A",function(i){i.preventDefault();i.stopPropagation();i.stopImmediatePropagation()});return h},fixWidth:function(k){var h=e(k||".modal");var o=h.children("div, form").first();var l=o.width()||h.width();var n=o.find("IFRAME");if(n.exists()){try{l=n[0].contentWindow.document.body.offsetWidth}catch(j){n=false;e.console.warn("[modal] Can't read iFrame properties",j)}}var m=l/2;var i=e(window).width();if(i/2<m){m=0}var h=o.closest(".modal").css("marginLeft",-m+"px");if(n&&n.exists()){h.css("width",(l+18)+"px")}}};e(document).ready(function(h){b()})}(window.jQuery);var deprecatedModal=function(a){jQuery.console.warn("[Deprecated] "+a+": JCMS requires the new Modal framework");jQuery.console.stacktrace()};JCMS=window.JCMS||{};JCMS.window=JCMS.window||{};JCMS.window.Modal=JCMS.window.Modal||{};JCMS.window.Modal.close=jQuery.jalios.ui.Modal.close;JCMS.window.Modal.relocate=function(){deprecatedModal("Modal.relocate")};JCMS.window.Modal.showJSP=function(a,c,b){deprecatedModal("Modal.showJSP");if(typeof b=="object"){a+="?"+jQuery.param(b,true)}jQuery.jalios.ui.Modal.openFromUrl(a,{callback:c})};JCMS.window.Modal.confirm=function(c,a,b){deprecatedModal("Modal.confirm");jQuery.jalios.ui.Modal.confirm(c,a)};function promptJSAction(c,b,a){deprecatedModal("promptJSAction");jQuery.jalios.ui.Modal.prompt(c,b,a)}function promptAction(d,b,c,a){deprecatedModal("promptAction");jQuery.jalios.ui.Modal.prompt(d,function(e){if(e===false){return}jQuery.jalios.Browser.redirect(jQuery.jalios.Http.getUrlWithUpdatedParam(b,c,e))},a)}function confirmJSAction(b,a){deprecatedModal("confirmJSAction");jQuery.jalios.ui.Modal.confirm(b,a)}function confirmAction(b,a){deprecatedModal("confirmAction");jQuery.jalios.ui.Modal.confirm(b,function(){jQuery.jalios.Browser.redirect(a)});return false}function confirmNoAction(b,a){deprecatedModal("confirmNoAction");jQuery.jalios.ui.Modal.confirm(b,function(){jQuery.jalios.Browser.redirect(a)},true)};