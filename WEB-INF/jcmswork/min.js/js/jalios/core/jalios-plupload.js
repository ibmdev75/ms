!function(g){var l="html5,flash,silverlight,gears,browserplus";var m=g.jalios.Http.getContextPath()+"/js/lib/plupload-1.5.8/js/plupload.flash.swf";var d=g.jalios.Http.getContextPath()+"/js/lib/plupload-1.5.8/js/plupload.silverlight.xap";var h=g.jalios.Http.getContextPath()+"/jcore/plupload.jsp";var c=g.jalios.Properties.get("plupload-filters");for(filterName in c){var a=c[filterName];a.title=g.jalios.I18N.glp("plupload-filters."+filterName)+" ("+a.extensions+")"}var j=false;var k=function(){if(j){return}j=true;g(document).on("jalios:refresh",function(p){var o=g.jalios.Event.match(p,"refresh","after");if(!o){return}e()});e()};var e=function(){g("DIV.plupload").jcmsPlupload()};g.fn.jcmsPlupload=function(){this.each(function(){var u=g(this);var r=u.attr("class");if(u.data("plupload")){return}if(u.parent().closest("DIV.plupload").exists()){return}if(!g.jalios.Browser.isIE(8)&&!u.hasClass("plupload-single")){u.hide()}var q={url:h,runtimes:l,max_file_size:"2000mb",multipart:true,required_features:"multipart",multipart_params:{},headers:{"X-Jcms-Plupload":"true"},preinit:function(v){v.bind("PostInit",g.proxy(b,u[0]))},init:function(v){u.data("plupload",v);v.bind("FileUploaded",g.proxy(f,u[0]));v.bind("FilesAdded",g.proxy(i,u[0]))},flash_swf_url:m,silverlight_xap_url:d};for(filterName in c){if(u.hasClass("plupload-filter-"+filterName)){q.filters=[c[filterName]]}}if(u.hasClass("plupload-single")){q.multi_selection=false;q.max_file_count=1}var p=r.match(/plupload-resize-(\d+)x(\d+)x(\d+)/);if(p&&p.length>1){q.resize={width:p[1],height:p[2],quality:p[3]}}var t=r.match(/plupload-field-(\w+)/);if(t){q.multipart_params.field=t[1]}var o=document.body.id;var s=r.match(/plupload-token-(\w+)/);q.multipart_params.token=s||o;u.closest("FORM").append('<input name="plupload-token" type="hidden" value="'+(s||o)+'"/>');u.closest("FORM").find(".plupload-submit").on("click",n);u.pluploadQueue(q)})};var b=function(){var o=g(this);if(!g.jalios.Browser.isIE(8)&&!o.hasClass("plupload-single")){if(!o.is(":visible")){o.slideDown()}}};var f=function(o,q,p){g(this).append('<input name="'+o.settings.multipart_params.field+'" type="hidden" value="MultipartUpload"/>')};var i=function(p,q){var r=g(this);var o=p.settings.max_file_count;if(p.files.length<=o){return}while(p.files.length>o){if(p.files.length>o){p.removeFile(p.files[o])}}g(".plupload-submit").show()};var n=function(p){var o=p.currentTarget;var q=g(o).closest("FORM").find("DIV.plupload");q.each(function(){var s=g(this);var r=s.data("plupload");if(!r){return}if(!s.data("p-init")){s.data("p-init",true);r.bind("UploadComplete",function(t,u){if(t.total.queued==0){g.jalios.DOM.follow(o)}})}if(r.total.queued!=0){r.start();p.preventDefault();p.stopPropagation();return false}})};g(document).on("jalios:ready",k)}(window.jQuery);