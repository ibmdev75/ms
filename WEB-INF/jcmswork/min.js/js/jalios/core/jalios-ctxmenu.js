var CtxMenuManager=CtxMenuManager||{};!function(f){var k=function(){f(document).on("jalios:broker",l);f(document).on("click",".ctxmenu",g);f(document).on("contextmenu",".ctxmenu-right",g);f(document).on("click","UL.dropdown-menu LI.disabled A",function(n){n.preventDefault()});f(document).on("jalios:refresh",function(o){var n=f.jalios.Event.match(o,"refresh","before");if(n){h()}});f(document).on("hide.bs.dropdown",function(n){n.preventDefault();f(n.target).removeClass("open")})};var i=/ctxmenu(-right)*/i;var l=function(o){var n=f.jalios.Event.match(o,"broker",i,true,true);if(!n){return}var p=n.source.currentTarget;j(p,n.options)};var g=function(n){n.preventDefault();n.stopImmediatePropagation();j(n.currentTarget)};var j=function(p,o){if(!p){return false}var n=f(p);f(document.body).addClass("contextual-menu-displayed");n.addClass("ctxTrigger");n.parent().addClass("ctxTriggerParent");CtxMenuManager.latestElement=n.identify().attr("id");f.jalios.ui.CtxMenu.$latest=n;n.dropdown("toggle");n.off("click.dropdown.data-api")};var h=function(){var n=f.jalios.ui.CtxMenu.$latest;if(n){f.jalios.ui.CtxMenu.hide();n.removeClass("ctxTrigger");n.parent().removeClass("ctxTriggerParent")}f(document.body).removeClass("contextual-menu-displayed");return false};var d=function(p,n){var r=p.data("ctxmenu.hint");if(r){p.removeClass(r)}var o=n;for(var q=0;q<10;q++){var r=o.matchClass(/hints-([\w-]+)/,1);if(!r||r.length<=0){o=o.parent();continue}r=r[0];p.addClass(r);p.data("ctxmenu.hint",r);return p}return p};var c=function(t){if(!t.html()){if(f.jalios.ui.CtxMenu.$latest){f.jalios.ui.CtxMenu.$latest.dropdown("toggle")}return}t.find("LI.disabled A[onclick]").each(function(){f(this).removeAttr("onclick")});var o=f(window);var w=o.width();var x=o.scrollLeft();var s=o.height();var u=o.scrollTop();t.addClass("open");var n=t.bounds();var r=(n.left+n.width)-(w+x);var p=(n.right+n.width)-(w+x);if(p>0){t.addClass("dropdown-menu-right");var q=r>0?n.left-r:n.left;if(q<0){q=0}t.css("left",q+"px")}else{t.css("left",n.left+12+"px");t.removeClass("dropdown-menu-right")}var v=n.top;if(n.bottom>s+u){v=n.top-(n.bottom-s-u)-10;t.css("top",v+"px")}if(v<40){t.css("top",40+"px")}};f.fn.dropdown.clearMenus=function(n){f(".dropdown.open").removeClass("open");f(".dropdown-menu.open").removeClass("open");f(".dropdown-menu.open").removeClass("open")};f.fn.dropdown.getParent=function(n,p){if(!n||!n.exists()||!n.attr("class")){return h()}o=e(n,p);if(o&&o.exists()){return d(o,n)}var o=m(n,p);if(o&&o.exists()){return d(o,n)}return h()};var e=function(o,p,t){if(p){return false}var q=o.attr("class");if(!q){return false}if(o.hasClass("mceButton")){return false}var n="#"+q.trim().replace(/\S+[%\/]+\S+/g,"").trim().split(/\s+/).join(", #");var r=f(n);if(!r.exists()){return false}if(!r.hasClass("dropdown-menu")){r.addClass("dropdown-menu");r.css("display","");r.appendTo(document.body)}var s=o.bounds();r.css("top",s.bottom+"px").css("left",s.left+"px");if(!t){r.addClass("open");c(r);r.removeClass("open")}return r};var a=false;var m=function(n,p){if(!(n.hasClass("ctxmenu")||n.hasClass("ctxmenu-right")||n.attr("data-jalios-action")=="ctxmenu")||n.attr("data-jalios-action")=="ctxmenu-right"){return false}if(p){return f("UL#ctxAjaxMenu")}if(a&&n.is(a)){return f("UL#ctxAjaxMenu")}a=n;var o=f("UL#ctxAjaxMenu");if(!o.exists()){o=f('<ul id="ctxAjaxMenu" class="dropdown-menu" role="menu" data-jalios-ajax-refresh-url="jcore/ctxmenu/ctxmenu.jsp"></ul>').appendTo(f(document.body))}f("#ctxAjaxMenu").html("<li>"+f.jalios.I18N.glp("info.msg.loading")+"</li>");var r={ctxId:n.getJcmsId(),classes:n.attr("class")};var s=n.closest(".TreeCat");if(s.exists()){r.context=s.attr("id")}n.refresh({target:"#ctxAjaxMenu",params:r,noscroll:true,nohistory:true,waiting:false,callback:c});var q=n.bounds();o.css("top",q.bottom+"px").css("left",q.left+"px");return o};var b=f.fn.closest;f.fn.closest=function(q,p){var n=f.proxy(b,this)(q,p);if(n.exists()){return n}var r=f.jalios.ui.CtxMenu.$latest;if(!r){return n}if(f("#ctxAjaxMenu").is(this)||f("#ctxAjaxMenu").find(this).exists()){return f.proxy(b,r)(q,p)}var o=e(r,false,true);if(o&&o.find(this).exists()){return f.proxy(b,r)(q,p)}return n};if(!f.jalios){f.jalios={}}if(!f.jalios.ui){f.jalios.ui={}}f.jalios.ui.CtxMenu={show:j,hide:f.fn.dropdown.clearMenus};f(document).ready(function(n){k()})}(window.jQuery);CtxMenuManager.hideAllCtxtMenus=function(){jQuery.fn.dropdown.clearMenus()};