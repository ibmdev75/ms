!function(e){var l=function(){e(document).on("focusin",".widget TEXTAREA.wikiarea",m);e(document).on("focusin",".widget .CodeMirror TEXTAREA",c);e(document).on("mousedown",".widget .CodeMirror .CodeMirror-toolbar BUTTON",h);e(document).on("click",".widget .CodeMirror .CodeMirror-toolbar BUTTON",function(n){n.preventDefault()});Typeahead.hooks.add(a);Typeahead.hooks.add(g);Typeahead.hooks.add(j);if(e.jalios.Wiki){e.jalios.Wiki.showWikiToolbar=function(n){}}};var d='<div class="CodeMirror-toolbar btn-toolbar"><div class="btn-group"><button type="button" class="btn btn-default btn-sm wiki-strong"><span class="fa fa-bold jalios-icon"></span></button><button type="button" class="btn btn-default btn-sm wiki-em"><span class="fa fa-italic jalios-icon "></span></button><button type="button" class="btn btn-default btn-sm wiki-wikiwyg"><span class="fa fa-eye jalios-icon"></span></button></div></div>';var h=function(o){if(!b||!b.doc){return}var n=e(o.currentTarget);var q=b.doc;var p=q.getSelection();if(n.hasClass("wiki-strong")){if(p.match(/\*[^*]+\*/)){q.replaceSelection(p.substring(1,p.length-1))}else{q.replaceSelection("*"+p+"*")}}else{if(n.hasClass("wiki-em")){if(p.match(/_[^_]+_/)){q.replaceSelection(p.substring(1,p.length-1))}else{q.replaceSelection("_"+p+"_")}}else{if(n.hasClass("wiki-wikiwyg")){e(b.getWrapperElement()).toggleClass("twikiwyg");b.refresh()}}}};var b=false;var m=function(s){var r=e(s.currentTarget);var p=r.data("CodeMirror");if(!p){p=CodeMirror.fromTextArea(r[0],{mode:"twiki",tabSize:2,lineNumbers:false,lineWrapping:true});var t=false;p.on("blur",function(u){u.save()});p.on("focus",function(u){b=u});p.on("keydown",function(u,v){t=v.keyCode});p.on("cursorActivity",function(v,w){var A=v.doc.getCursor();var z=v.getTokenAt(A);if(z.type=="token-end"){var u=Math.abs(z.end-z.start);if(t==39){v.moveH(u,"char")}else{v.moveH(-u,"char")}}var y=jQuery.extend({},A);y.ch+=1;var x=v.getTokenAt(y);if(x.type=="token-start"){var u=Math.abs(x.end-x.start);if(t==37){v.moveH(-u,"char")}else{v.moveH(u,"char")}}});var o=30*14+2;var q=p.doc.lineCount()*14+2;var n=r.height();n=n>q?n:(q>o?o:q);r.data("CodeMirror",p);e(p.getWrapperElement()).prepend(d);e(p.getWrapperElement()).toggleClass("twikiwyg");p.refresh()}p.setValue(r.val())};var c=function(q){var o=e(q.currentTarget);if(o.data("typeahead")){return}var p=e('<div class="typeahead-menu ajax-refresh-div"></div>');var n="jcore/autocomplete/acwiki.jsp";o.typeahead({menu:p,ajax:n})};var i=CodeMirror.Pos;var k=function(){if(!b||!b.doc){return{word:""}}var p=b.doc;var n=p.getCursor();var q=jQuery.extend({},n);for(;q.ch>0;q.ch--){if(b.getTokenAt(q).string==" "){break}}var o=b.getRange(q,n);return{start:q,end:n,word:o}};var f=function(o,n){if(!b||!b.doc){return}b.doc.replaceRange(o,n.start,n.end)};var g=function(p){if(p.type!="select"){return}var n=p.typeahead.$element;if(n.prop("tagName")!="TEXTAREA"){return}var r=p.$active;var o=k();var q=r.attr("data-value");var s=r.attr("data-placeholder");if(s){q="[["+q+"]["+(s||o.word)+"]]"}f(q,o);n.change();p.stop=true};var a=function(p){if(p.type!="lookup"){return}var o=p.typeahead;var n=o.$element;var q=k().word;if(q&&q.length>1&&(q.indexOf("@")==0||q.indexOf("#")==0)){o.query=q;o.show()}else{if(p.explicit){o.query=q;o.show()}else{p.stop=true}}};var j=function(n){if(n.type!="show"){return}};e(document).ready(function(n){l()})}(window.jQuery);