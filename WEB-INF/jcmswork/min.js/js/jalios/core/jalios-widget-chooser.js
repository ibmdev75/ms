!function(g){var a=/(chooser):([\w-]+)/i;var n=/(widget):([\w-]+)/i;var m={acl:{path:"admin/aclChooser.jsp?",name:"ACL"},category:{path:"work/categoryChooser.jsp?cids={value}&",name:"Category"},country:{path:"admin/countryChooser.jsp?",name:"Country"},dbrecord:{path:"work/dbrecordChooser.jsp?",name:"DBRecord"},document:{path:"work/docChooser.jsp?nbElt=1&",name:"Document"},group:{path:"admin/groupChooser.jsp?",name:"Group"},image:{path:"work/mediaBrowser.jsp?selectMode=true&medias=image&",name:"Image",ref:"mediabrowser"},media:{path:"work/mediaBrowser.jsp?selectMode=true&",name:"Media",ref:"mediabrowser"},member:{path:"admin/memberChooser.jsp?",name:"Member"},publication:{path:"work/pubChooser.jsp?",name:"Publication"},query:{path:"work/queryChooser.jsp?qs={value}&",name:"Query"},workspace:{path:"work/workspace/workspaceChooser.jsp?",name:"Workspace"}};var l=function(){g(document).on("jalios:broker",b);g(document).on("keyup",".duration_user",function(p){var o=g(p.currentTarget);f(o,1000)});g(document).on("change",".duration_unit",function(p){var o=g(p.currentTarget);f(o,1000)});g(document).on("change",".jalios-country",function(p){var o=g(p.currentTarget);o.prev("INPUT.jalios-country-display").removeClass(p.previousValue+"-flag").addClass(p.currentVal+"-flag")});g(document).on("change",".form-control-value.jalios-workspace",function(p){var o=g(p.currentTarget);var s=o.closest(".widget");if(!s||!s.exists()){return}var r=s.find(".triggerWsChangeRefresh");if(!r||!r.exists()){return}var q=s.find(".workspaceChangeEvent");if(!q||!q.exists()){return}q.val(true);o.refresh()})};var b=function(o){var t=g.jalios.Event.match(o,"broker");if(!t){return}var s=t.type.match(a);var r=t.type.match(n);if(!(s||r)){return}var z=s?t.type.match(a):t.type.match(n);var p=z[1];var x=z[2];if(!p||!x){return}var q=g(t.source.currentTarget);var v=q.parent().prevAll("INPUT.form-control-value");var A=t.options;if(m[x]){k(v,x,A,q)}else{if(x=="color"){if(!v.exists()&&q.is("INPUT")){v=q}v.colorpicker("show").on("changeColor",function(D){var B=v.val();var C=D.color.toHex();v.val(D.color.toHex());v.prev("SPAN.input-group-addon").css("background-color",C);v.trigger(jQuery.Event("change",{previousValue:B,currentVal:C}))}).on("hide",function(B){B.preventDefault()});v.keyup(function(){if(!this.value){v.prev("SPAN.input-group-addon").css("background","")}})}else{if(x=="duration"){}else{if(x=="date"){if(!v.exists()&&q.is("INPUT")){v=q}c(q,v)}else{if(x=="clear"){g.jalios.ui.Widget.clear(v);if(v.hasClass("control-color")&&!v.val()){v.prev("SPAN.input-group-addon").css("background","")}if(v.hasClass("jalios-country")&&!v.val()){var y=v.prev(".control-country");var w=y[0].className.match(/\w*-flag/g);if(w){for(var u=0;u<w.length;u++){y.removeClass(w[u])}y.addClass("-flag")}}}else{if(q.attr("data-jalios-chooser")){A.customId=x;k(v,q.attr("data-jalios-chooser"),A,q)}}}}}}return false};var k=function(q,s,r,o){var t=function(w,E,x,v){var C=q.parent();var D=C.find("INPUT.form-control-display");if(D.exists()){var B=q.val();q.val(w||"").trigger(jQuery.Event("change",{previousValue:B,currentVal:w}));var y=D.val();D.val(E||"").trigger(jQuery.Event("change",{previousValue:y,currentVal:E}))}else{var A=q.val();q.val(v||"").trigger(jQuery.Event("change",{previousValue:A,currentVal:v}))}var z=C.find(".jalios-publication-filebrowser");if(z.exists()){z.addClass("hide");if(z.is(":input")){z.prop("disabled",true)}else{z.find('INPUT[type="file"]').prop("disabled",true)}D.removeClass("hide");D.prop("disabled",false);q.prop("disabled",false)}var u=q.closest(".widget");if(u.exists()&&u.hasClass("keyword")){JCMS.form.Widget.add(D[0])}};var p={currentValue:q.val(),params:r,popup:{}};if(o.data("jalios-chooser-popup-width")){p.popup.width=o.data("jalios-chooser-popup-width")}if(o.data("jalios-chooser-popup-height")){p.popup.height=o.data("jalios-chooser-popup-height")}g.jalios.ui.Widget.Chooser.openDataChooser(s,t,p)};var c=function(o,q){if(o.data("datetimepicker")){return}var p=o.closest(".widget").hasClass("jalios-date-time");o.datetimepicker({language:document.documentElement.getAttribute("xml:lang"),format:d(!p),autoclose:true,todayBtn:true,minuteStep:15,minView:(p?0:2)}).on("changeDate",function(r){q.val(g(this).data("datetimepicker").getFormattedDate());q.trigger(jQuery.Event("change"))}).on("show",function(r){q.data("jalios-previous-value",q.val())}).datetimepicker("show");o.data("datetimepicker").update(j(q.val(),p))};g.jalios.ui.Widget.Chooser={openDataChooser:function(p,v,s){var s=s||{};s.currentValue=s.currentValue||"";s.params=s.params||{};var v=v||function(w){};var r,u,q;if(m[p]){r=m[p]["ref"]||p;u=m[p].path;q=m[p].name}else{r=s.params.customId||"custom";u=p;q="Custom"}u=u.replace(/{value}/,encodeURIComponent(s.currentValue));u=u+g.param(s.params,true);u=g.jalios.Http.getContextPath()+"/"+u;s=g.extend({popup:{width:930,height:570}},s);var t=s.popup.width;var o=s.popup.height;g.jalios.Browser.popupWindow(u,q,t,o,false,true,true,false,false,v)}};var j=function(r,o,q){if(!r){var p=new Date();p.setMinutes(0);p.setHours(9);return p}return i(r,o,q)};var i=function(s,o,r){if(!s){return}var q=g.fn.datetimepicker.DPGlobal.parseFormat(d(!o),"standard");var p=g.fn.datetimepicker.DPGlobal.parseDate(s,q,r||I18N["lang.datepicker"],"standard");return new Date(p.getTime()+p.getTimezoneOffset()*60*1000)};var e=function(p,o,r){if(!p){return}var q=g.fn.datetimepicker.DPGlobal.parseFormat(d(!o),"standard");p=new Date(p.getTime()-p.getTimezoneOffset()*60*1000);return g.fn.datetimepicker.DPGlobal.formatDate(p,q,r||I18N["lang.datepicker"],"standard")};var d=function(o){return I18N.glp(o?"datechooser.js.date-format":"datechooser.js.date-time-format")};var h=function(q){var r=q.closest(".widget").hasClass("jalios-date-time");var s=q.val();if(!s){return}var o=parseInt(s);var p=new Date(o);q.val(e(p,r))};var f=function(o,q){var u=g.jalios.ui.Widget.getWrapper(o);var s=u.find("INPUT.duration");var r=u.find("INPUT.duration_user");var p=u.find("SELECT.duration_unit");if(!r.exists()){return}r.val(r.val().replace(/[^0-9\.]/,""));var t=r.val()?parseInt(Math.round(r.val()))*parseInt(p.val()):"";s.val(t)};g.jalios.ui.Widget.Date={stringToDate:i,dateToString:e,getDateFormat:d,updateDuration:f,updateDate:h,openDateChooser:c};g(document).ready(function(o){l()})}(window.jQuery);