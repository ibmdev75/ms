var register=function(b,d,c,g,e,f){var a=function(i){var h=i.refresh;ok(h,"Event had refresh infos");if(!h){return}if(h.type=="before"){equals(h.url,d,"url decode from magic trick data-jalios-ajax-refresh-url");equals(h.target[0],b[0],"target is ajax-refresh-div wrapper");equals(h.options.method,g,"performs a "+g);ok(!h.options.periodical,"is not periodical");equals(h.options.trigger,c,"has a trigger based on input id");e(h)}else{if(h.type=="after"){if(f){f(h)}else{equals($(".ajax-content",b).html(),"Hello Fragment","has been updated by fragment content")}$(document).off("jalios:refresh",a);start()}}};$(document).on("jalios:refresh",a)};$(function(){module("jalios-ajax-refresh");test("should refresh from a given link",function(){stop(5000);register($("#wrapper1"),"assets/jalios-ajax-refresh-fragment.html","#link1",undefined,function(a){ok(a.options.params,"has parameters");equals(a.options.params.param1,"value1","has parameters param1=value1")});$("#link1").refresh()});test("should refresh from a given form",function(){stop(5000);register($("#wrapper2"),"assets/jalios-ajax-refresh-fragment.html","#link2","POST",function(a){ok(a.options.params,"has parameters");equals(a.options.params.param1,"value1","has parameters param1=value1");equals(a.options.params.opSubmit,"true","has parameters opSubmit=true")});$("#link2").refresh()});test("should refresh from a given link",function(){stop(5000);register($("#wrapper3"),"assets/jalios-ajax-refresh-fragment.html","#link3","POST",function(a){ok(a.options.nohistory,"nohistory is true");ok(a.options.nofocus,"nofocus is true");ok(a.options.noscroll,"noscroll is true");ok(a.options.noerror,"noerror is true");ok(a.options.isform,"isform is true")});$("#link3").refresh()});test("should refresh from DIV",function(){stop(5000);register($("#wrapper4"),"assets/jalios-ajax-refresh-fragment.html","#wrapper4",undefined,function(a){});$("#wrapper4").refresh()});test("should refresh and append to DIV.ajax-append",function(){stop(5000);register($("#wrapper5"),"assets/jalios-ajax-refresh-fragment.html","#wrapper5",undefined,function(a){},function(b){var a=b.target;equals($(".ajax-content",a).html(),"Hello HTML","has not been updated by fragment content");equals($(".ajax-inner",a).html(),"Hello Fragment","has been append");ok(!$(".ajax-append").exists(),"ajax-append has been removed/repmlaced")});$("#wrapper5").refresh()})});